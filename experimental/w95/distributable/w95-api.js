(()=>{var __webpack_modules__={960:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n});const n="object"==typeof window?void 0:{assert:function(e,t="Assertion failure"){if(!e)throw new Error(t)},throw:function(e=""){throw new Error(e)}}},675:()=>{(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Rngon:()=>oe});const r="object"==typeof window?void 0:function(e,t){if(!e)throw new Error(t)},n="object"==typeof window?void 0:function(e,t,o=t.properties,i=""){r?.(e&&"object"==typeof e,"Schemas can't be evaluated for non-object types."),r?.(t&&"object"==typeof t&&o&&"object"==typeof o&&"string"==typeof i,"Malformed schema.");{const r=Object.keys(e),n=Object.keys(o).filter((e=>!r.includes(e))).filter((e=>!o[e].optional));if(n.length)throw new Error(`Missing property '${n.map((e=>i+e)).join("', '")}' ${t.where}.`)}for(const[r,s]of Object.entries(e)){if(!o.hasOwnProperty(r)){if(t.allowAdditionalProperties)continue;throw new Error(`Unsupported property '${i+r}' ${t.where}.`)}const e=o[r],d=e?.type||e,l=a(s);if(e.hasOwnProperty?.("value")){const n=e.value;switch(typeof n){case"function":{const e=n(s);if("string"==typeof e)throw new Error(e);break}default:if(s!==n)throw new Error(`The property '${i+r}' ${t.where} doesn't evaluate to "${e.value}".`)}}else if(e.hasOwnProperty?.("subschema")){if("object"!==l.toLowerCase())throw new TypeError(`The property '${i+r}' ${t.where} must be of type Object.`);n(s,{...e.subschema,where:t.where},e.subschema.properties||e.subschema,`${i}${r}.`)}else{if(!Array.isArray(d))throw new SyntaxError("Invalid schema");if("array"===l){const e=d.filter((e=>Array.isArray(e)));let n=!1;for(let t of e)if(t=t.map((e=>e.toLowerCase())),n=s.every((e=>t.includes(a(e).toLowerCase()))),n)break;if(!n)throw new TypeError(`The array '${i+r}' ${t.where} contains one or more unsupported element types.`)}else if(!d.filter((e=>"string"==typeof e)).map((e=>e.toLowerCase())).includes(l.toLowerCase()))throw new TypeError(`The property '${i+r}' ${t.where} is of unsupported type "${l}".`)}}function a(e){return null===e?"null":Array.isArray(e)?"array":"string"==typeof e?.$constructor?e.$constructor:"function"==typeof e?.constructor?e.constructor.name:typeof e}},o={arguments:{where:"in arguments to Rngon::matrix()",properties:{data:{type:[["number"]],value(e){if(16!==e.length)return"Matrices must be 4 x 4"}}}},interface:{where:"in the return value of Rngon::matrix()",properties:{$constructor:{value:"Matrix"},data:{type:[["number"]],value(e){if(16!==e.length)return"Matrices must be 4 x 4"}}}}};function i(...e){e.length||(e=i.identity().data),n?.({data:e},o.arguments);const t={$constructor:"Matrix",data:e};return n?.(t,o.interface),t}i.multiply=function(e=i(),t=i()){let r=i();for(let n=0;n<4;n++)for(let o=0;o<16;o+=4)r.data[n+o]=e.data[n]*t.data[o]+e.data[n+4]*t.data[o+1]+e.data[n+8]*t.data[o+2]+e.data[n+12]*t.data[o+3];return r},i.identity=function(){return i(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},i.scaling=function(e=0,t=0,r=0){return i(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1)},i.translating=function(e=0,t=0,r=0){return i(1,0,0,0,0,1,0,0,0,0,1,0,e,t,r,1)},i.rotating=function(e=0,t=0,r=0){const n=Math.PI/180;e*=n,t*=n,r*=n;const o=Math.sin(e),a=Math.cos(e),s=Math.sin(t),d=Math.cos(t),l=Math.sin(r),c=Math.cos(r),u=i(1,0,0,0,0,a,-o,0,0,o,a,0,0,0,0,1),f=i(d,0,s,0,0,1,0,0,-s,0,d,0,0,0,0,1),h=i(c,-l,0,0,l,c,0,0,0,0,1,0,0,0,0,1);return i.multiply(u,i.multiply(f,h))};const a={where:"in arguments to Rngon::vertex()",properties:{x:["number"],y:["number"],z:["number"],u:["number"],v:["number"],w:["number"],shade:["number"],worldX:["number"],worldY:["number"],worldZ:["number"],normalX:["number"],normalY:["number"],normalZ:["number"]}},s={where:"in the return value of Rngon::vertex()",properties:{$constructor:{value:"Vertex"},x:["number"],y:["number"],z:["number"],u:["number"],v:["number"],w:["number"],shade:["number"],worldX:["number"],worldY:["number"],worldZ:["number"],normalX:["number"],normalY:["number"],normalZ:["number"]}};function d(e=0,t=0,r=0,o=0,i=0,d=1,l=0,c=0,u=1,f=1,h=e,p=t,w=r){n?.({x:e,y:t,z:r,u:o,v:i,w:u,shade:f,worldX:h,worldY:p,worldZ:w,normalX:d,normalY:l,normalZ:c},a);const g={$constructor:"Vertex",x:e,y:t,z:r,u:o,v:i,w:u,shade:f,worldX:h,worldY:p,worldZ:w,normalX:d,normalY:l,normalZ:c};return n?.(g,s),g}d.transform=function(e=d(),t=i()){const r=t.data[0]*e.x+t.data[4]*e.y+t.data[8]*e.z+t.data[12]*e.w,n=t.data[1]*e.x+t.data[5]*e.y+t.data[9]*e.z+t.data[13]*e.w,o=t.data[2]*e.x+t.data[6]*e.y+t.data[10]*e.z+t.data[14]*e.w,a=t.data[3]*e.x+t.data[7]*e.y+t.data[11]*e.z+t.data[15]*e.w;e.x=r,e.y=n,e.z=o,e.w=a};const l={where:"in the return value of Rngon::vector()",properties:{$constructor:{value:"Vector"},x:["number"],y:["number"],z:["number"]}},c={where:"in arguments to Rngon::vector()",properties:{x:["number"],y:["number"],z:["number"]}};function u(e=0,t=0,r=0){n?.({x:e,y:t,z:r},c);const o={$constructor:"Vector",x:e,y:t,z:r};return n?.(o,l),o}u.transform=function(e=u(),t=Matrix()){const r=t.data[0]*e.x+t.data[4]*e.y+t.data[8]*e.z,n=t.data[1]*e.x+t.data[5]*e.y+t.data[9]*e.z,o=t.data[2]*e.x+t.data[6]*e.y+t.data[10]*e.z;e.x=r,e.y=n,e.z=o},u.normalize=function(e=u()){const t=e.x*e.x+e.y*e.y+e.z*e.z;if(0!=t&&1!=t){const r=1/Math.sqrt(t);e.x*=r,e.y*=r,e.z*=r}},u.dot=function(e=u(),t=u()){return e.x*t.x+e.y*t.y+e.z*t.z},u.cross=function(e=u(),t=u()){const r=u();return r.x=e.y*t.z-e.z*t.y,r.y=e.z*t.x-e.x*t.z,r.z=e.x*t.y-e.y*t.x,r},u.invert=function(e=vector()){e.x*=-1,e.y*=-1,e.z*=-1};const f={where:"in arguments to Rngon::color()",properties:{red:["number"],green:["number"],blue:["number"],alpha:["number"]}},h={where:"in the return value of Rngon::color()",properties:{$constructor:{value:"Color"},red:["number"],green:["number"],blue:["number"],alpha:["number"],unitRange:{subschema:{red:["number"],green:["number"],blue:["number"],alpha:["number"]}}}};function p(e=0,t=e,o=e,i=255){n?.({red:e,green:t,blue:o,alpha:i},f),r?.(e>=0&&e<=255&&t>=0&&t<=255&&o>=0&&o<=255&&i>=0&&i<=255,"One or more of the given color values are out of range.");const a={$constructor:"Color",red:e,green:t,blue:o,alpha:i,unitRange:{red:e/255,green:t/255,blue:o/255,alpha:i/255}};return n?.(a,h),a}p.aliceblue=Object.freeze(p(240,248,255)),p.antiquewhite=Object.freeze(p(250,235,215)),p.aqua=Object.freeze(p(0,255,255)),p.aquamarine=Object.freeze(p(127,255,212)),p.azure=Object.freeze(p(240,255,255)),p.beige=Object.freeze(p(245,245,220)),p.bisque=Object.freeze(p(255,228,196)),p.black=Object.freeze(p(0,0,0)),p.blanchedalmond=Object.freeze(p(255,235,205)),p.blue=Object.freeze(p(0,0,255)),p.blueviolet=Object.freeze(p(138,43,226)),p.brown=Object.freeze(p(165,42,42)),p.burlywood=Object.freeze(p(222,184,135)),p.cadetblue=Object.freeze(p(95,158,160)),p.chartreuse=Object.freeze(p(127,255,0)),p.chocolate=Object.freeze(p(210,105,30)),p.coral=Object.freeze(p(255,127,80)),p.cornflowerblue=Object.freeze(p(100,149,237)),p.cornsilk=Object.freeze(p(255,248,220)),p.crimson=Object.freeze(p(220,20,60)),p.cyan=Object.freeze(p(0,255,255)),p.darkblue=Object.freeze(p(0,0,139)),p.darkcyan=Object.freeze(p(0,139,139)),p.darkgoldenrod=Object.freeze(p(184,134,11)),p.darkgray=Object.freeze(p(169,169,169)),p.darkgreen=Object.freeze(p(0,100,0)),p.darkgrey=Object.freeze(p(169,169,169)),p.darkkhaki=Object.freeze(p(189,183,107)),p.darkmagenta=Object.freeze(p(139,0,139)),p.darkolivegreen=Object.freeze(p(85,107,47)),p.darkorange=Object.freeze(p(255,140,0)),p.darkorchid=Object.freeze(p(153,50,204)),p.darkred=Object.freeze(p(139,0,0)),p.darksalmon=Object.freeze(p(233,150,122)),p.darkseagreen=Object.freeze(p(143,188,143)),p.darkslateblue=Object.freeze(p(72,61,139)),p.darkslategray=Object.freeze(p(47,79,79)),p.darkslategrey=Object.freeze(p(47,79,79)),p.darkturquoise=Object.freeze(p(0,206,209)),p.darkviolet=Object.freeze(p(148,0,211)),p.deeppink=Object.freeze(p(255,20,147)),p.deepskyblue=Object.freeze(p(0,191,255)),p.dimgray=Object.freeze(p(105,105,105)),p.dimgrey=Object.freeze(p(105,105,105)),p.dodgerblue=Object.freeze(p(30,144,255)),p.firebrick=Object.freeze(p(178,34,34)),p.floralwhite=Object.freeze(p(255,250,240)),p.forestgreen=Object.freeze(p(34,139,34)),p.fuchsia=Object.freeze(p(255,0,255)),p.gainsboro=Object.freeze(p(220,220,220)),p.ghostwhite=Object.freeze(p(248,248,255)),p.gold=Object.freeze(p(255,215,0)),p.goldenrod=Object.freeze(p(218,165,32)),p.gray=Object.freeze(p(128,128,128)),p.green=Object.freeze(p(0,128,0)),p.greenyellow=Object.freeze(p(173,255,47)),p.grey=Object.freeze(p(128,128,128)),p.honeydew=Object.freeze(p(240,255,240)),p.hotpink=Object.freeze(p(255,105,180)),p.indianred=Object.freeze(p(205,92,92)),p.indigo=Object.freeze(p(75,0,130)),p.ivory=Object.freeze(p(255,255,240)),p.khaki=Object.freeze(p(240,230,140)),p.lavender=Object.freeze(p(230,230,250)),p.lavenderblush=Object.freeze(p(255,240,245)),p.lawngreen=Object.freeze(p(124,252,0)),p.lemonchiffon=Object.freeze(p(255,250,205)),p.lightblue=Object.freeze(p(173,216,230)),p.lightcoral=Object.freeze(p(240,128,128)),p.lightcyan=Object.freeze(p(224,255,255)),p.lightgoldenrodyellow=Object.freeze(p(250,250,210)),p.lightgray=Object.freeze(p(211,211,211)),p.lightgreen=Object.freeze(p(144,238,144)),p.lightgrey=Object.freeze(p(211,211,211)),p.lightpink=Object.freeze(p(255,182,193)),p.lightsalmon=Object.freeze(p(255,160,122)),p.lightseagreen=Object.freeze(p(32,178,170)),p.lightskyblue=Object.freeze(p(135,206,250)),p.lightslategray=Object.freeze(p(119,136,153)),p.lightslategrey=Object.freeze(p(119,136,153)),p.lightsteelblue=Object.freeze(p(176,196,222)),p.lightyellow=Object.freeze(p(255,255,224)),p.lime=Object.freeze(p(0,255,0)),p.limegreen=Object.freeze(p(50,205,50)),p.linen=Object.freeze(p(250,240,230)),p.magenta=Object.freeze(p(255,0,255)),p.maroon=Object.freeze(p(128,0,0)),p.mediumaquamarine=Object.freeze(p(102,205,170)),p.mediumblue=Object.freeze(p(0,0,205)),p.mediumorchid=Object.freeze(p(186,85,211)),p.mediumpurple=Object.freeze(p(147,112,219)),p.mediumseagreen=Object.freeze(p(60,179,113)),p.mediumslateblue=Object.freeze(p(123,104,238)),p.mediumspringgreen=Object.freeze(p(0,250,154)),p.mediumturquoise=Object.freeze(p(72,209,204)),p.mediumvioletred=Object.freeze(p(199,21,133)),p.midnightblue=Object.freeze(p(25,25,112)),p.mintcream=Object.freeze(p(245,255,250)),p.mistyrose=Object.freeze(p(255,228,225)),p.moccasin=Object.freeze(p(255,228,181)),p.navajowhite=Object.freeze(p(255,222,173)),p.navy=Object.freeze(p(0,0,128)),p.oldlace=Object.freeze(p(253,245,230)),p.olive=Object.freeze(p(128,128,0)),p.olivedrab=Object.freeze(p(107,142,35)),p.orange=Object.freeze(p(255,165,0)),p.orangered=Object.freeze(p(255,69,0)),p.orchid=Object.freeze(p(218,112,214)),p.palegoldenrod=Object.freeze(p(238,232,170)),p.palegreen=Object.freeze(p(152,251,152)),p.paleturquoise=Object.freeze(p(175,238,238)),p.palevioletred=Object.freeze(p(219,112,147)),p.papayawhip=Object.freeze(p(255,239,213)),p.peachpuff=Object.freeze(p(255,218,185)),p.peru=Object.freeze(p(205,133,63)),p.pink=Object.freeze(p(255,192,203)),p.plum=Object.freeze(p(221,160,221)),p.powderblue=Object.freeze(p(176,224,230)),p.purple=Object.freeze(p(128,0,128)),p.red=Object.freeze(p(255,0,0)),p.rosybrown=Object.freeze(p(188,143,143)),p.royalblue=Object.freeze(p(65,105,225)),p.saddlebrown=Object.freeze(p(139,69,19)),p.salmon=Object.freeze(p(250,128,114)),p.sandybrown=Object.freeze(p(244,164,96)),p.seagreen=Object.freeze(p(46,139,87)),p.seashell=Object.freeze(p(255,245,238)),p.sienna=Object.freeze(p(160,82,45)),p.silver=Object.freeze(p(192,192,192)),p.skyblue=Object.freeze(p(135,206,235)),p.slateblue=Object.freeze(p(106,90,205)),p.slategray=Object.freeze(p(112,128,144)),p.slategrey=Object.freeze(p(112,128,144)),p.snow=Object.freeze(p(255,250,250)),p.springgreen=Object.freeze(p(0,255,127)),p.steelblue=Object.freeze(p(70,130,180)),p.tan=Object.freeze(p(210,180,140)),p.teal=Object.freeze(p(0,128,128)),p.thistle=Object.freeze(p(216,191,216)),p.tomato=Object.freeze(p(255,99,71)),p.transparent=Object.freeze(p(0,0,0,0)),p.turquoise=Object.freeze(p(64,224,208)),p.violet=Object.freeze(p(238,130,238)),p.wheat=Object.freeze(p(245,222,179)),p.white=Object.freeze(p(255,255,255)),p.whitesmoke=Object.freeze(p(245,245,245)),p.yellow=Object.freeze(p(255,255,0)),p.yellowgreen=Object.freeze(p(154,205,50));const w={color:p.white,wireframeColor:p.black,texture:void 0,textureMapping:"ortho",textureFiltering:"none",uvWrapping:"repeat",vertexShading:"none",renderVertexShade:!0,ambientLightLevel:0,hasWireframe:!1,hasFill:!0,isTwoSided:!1,isInScreenSpace:!1,allowAlphaReject:!1,allowAlphaBlend:!1,bypassPixelBuffer:!1,depthOffset:0},g={where:"in arguments to Rngon::ngon()",properties:{vertices:[["Vertex"]],material:["object"],vertexNormals:[["Vector"],"Vector"]}},m={where:"in the return value of Rngon::ngon()",properties:{$constructor:{value:"Ngon"},vertices:[["Vertex"]],vertexNormals:[["Vector"]],normal:["Vector"],material:{subschema:{allowAdditionalProperties:!0,properties:{color:["Color"],wireframeColor:["Color"],texture:["undefined","null","Texture"],textureMapping:["string"],textureFiltering:["string"],uvWrapping:["string"],vertexShading:["string"],renderVertexShade:["boolean"],ambientLightLevel:["number"],hasWireframe:["boolean"],hasFill:["boolean"],isTwoSided:["boolean"],isInScreenSpace:["boolean"],allowAlphaReject:["boolean"],allowAlphaBlend:["boolean"],depthOffset:["number"]}}},mipLevel:["number"]}};function b(e=[d()],t={},r=u(0,1,0)){for(const e of Object.keys(w))t.hasOwnProperty(e)||(t[e]=w[e]);n?.({vertices:e,material:t,vertexNormals:r},g),Array.isArray(r)||(r=new Array(e.length).fill().map((e=>u(r.x,r.y,r.z))));const o=r.reduce(((e,t)=>(e.x+=t.x,e.y+=t.y,e.z+=t.z,e)),u(0,0,0));u.normalize(o);{const t=e.map((e=>e.u)).some((e=>e<0)),r=e.map((e=>e.v)).some((e=>e<0));if(t||r)for(const n of e)t&&0===n.u&&(n.u=-Number.EPSILON),r&&0===n.v&&(n.v=-Number.EPSILON)}const i={$constructor:"Ngon",vertices:e,vertexNormals:r,normal:o,material:t,mipLevel:0};return n?.(i,m),i}b.perspective_divide=function(e=b()){for(const t of e.vertices)t.x/=t.w,t.y/=t.w},b.transform=function(e=b(),t=i()){for(const r of e.vertices)d.transform(r,t)};const y=["x","y","z"],x=[1,-1];function _(e,t,r){return e+r*(t-e)}b.clip_to_viewport=function(e){for(const t of y)for(const r of x){if(!e.vertices.length)break;if(1==e.vertices.length){if(e.vertices[0].x<=e.vertices[0].w&&-e.vertices[0].x<=e.vertices[0].w&&e.vertices[0].y<=e.vertices[0].w&&-e.vertices[0].y<=e.vertices[0].w&&e.vertices[0].z<=e.vertices[0].w&&-e.vertices[0].z<=e.vertices[0].w)break;e.vertices.length=0;break}let n=e.vertices[e.vertices.length-(2==e.vertices.length?2:1)],o=n[t]*r,i=o<=n.w,a=0;const s=e.vertices.length;for(let l=0;l<s;l++){const c=e.vertices[l],u=c[t]*r,f=u<=c.w;if(f^i){const t=(n.w-o)/(n.w-o-(c.w-u));e.vertices[s+a++]=d(_(n.x,c.x,t),_(n.y,c.y,t),_(n.z,c.z,t),_(n.u,c.u,t),_(n.v,c.v,t),_(n.normalX,c.normalX,t),_(n.normalY,c.normalY,t),_(n.normalZ,c.normalZ,t),_(n.w,c.w,t),_(n.shade,c.shade,t),_(n.worldX,c.worldX,t),_(n.worldY,c.worldY,t),_(n.worldZ,c.worldZ,t))}f&&(e.vertices[s+a++]=c),n=c,o=u,i=f}e.vertices.splice(0,s)}};const v={enabled:[[[.25,0],[.5,.75]],[[.75,.5],[0,.25]]],disabled:[[[0,0],[0,0]],[[0,0],[0,0]]]};function M({renderContext:e,ngon:t,leftEdges:r,rightEdges:n,numLeftEdges:o,numRightEdges:i}){if(!o||!i)return!0;const a=e.useFullInterpolation,s=e.useFragmentBuffer,d=e.fragments,l=e.fragmentBuffer.data,c=e.useDepthBuffer?e.depthBuffer.data:null,u=e.pixelBuffer.width,f=t.material,h=f.texture||null,p=h&&"dither"===f.textureFiltering?v.enabled:v.disabled;let w=null,g=0;if(h){const e=h.mipLevels.length;g=Math.max(0,Math.min(e-1,Math.round((e-1)*t.mipLevel))),w=h.mipLevels[g]}let m=0,b=0,y=r[m],x=n[b];const _=r[0].top,M=r[o-1].bottom;let O=_-1;for(;++O<M;){const o=Math.min(u,Math.max(0,Math.round(y.x))),i=Math.min(u,Math.max(0,Math.ceil(x.x))),g=i-o+1;if(g>0){const r=a?1:y.invW,n=a?1:x.invW,m=a?(x.invW-y.invW)/g:0,b=a?y.invW:1,v=(x.depth/n-y.depth/r)/g,z=y.depth/r,j=(x.shade/n-y.shade/r)/g,B=y.shade/r,k=(x.u/n-y.u/r)/g,S=y.u/r,W=(x.v/n-y.v/r)/g,I=y.v/r,$=(x.worldX/n-y.worldX/r)/g,R=y.worldX/r,A=(x.worldY/n-y.worldY/r)/g,E=y.worldY/r,C=(x.worldZ/n-y.worldZ/r)/g,L=y.worldZ/r,D=(x.normalX/n-y.normalX/r)/g,T=y.normalX/r,H=(x.normalY/n-y.normalY/r)/g,N=y.normalY/r,Y=(x.normalZ/n-y.normalZ/r)/g,V=y.normalZ/r;let q=o+O*u-1,F=o-1,X=0;for(;++F<i;){let r=0,n=0;const i=z+v*X,a=B+j*X,u=S+k*X,y=I+W*X,x=b+m*X,Z=R+$*X,U=E+A*X,K=L+C*X,G=T+D*X,J=N+H*X,Q=V+Y*X;q++,X++;const ee=i/x;if(c&&c[q]<=ee)continue;let te=f.renderVertexShade?a/x:1,re=0,ne=0,oe=0;if(h){switch(f.textureMapping){case"affine":switch(r=u/x,n=y/x,f.uvWrapping){case"clamp":{const e=1-Number.EPSILON;r=r<0?e+r:r,n=n<0?e+n:n;const t=p[1&O][1&F];r+=t[0]/w.width,n+=t[1]/w.height,r=w.width*(r<0?0:r>e?e:r),n=w.height*(n<0?0:n>e?e:n);break}case"repeat":{const e=p[1&O][1&F];r+=e[0]/w.width,n+=e[1]/w.height,r=w.width*(r-Math.floor(r)),n=w.height*(n-Math.floor(n));const t=Math.abs(r),o=Math.abs(n),i=t-~~t,a=o-~~o;r=(r&w.width-1)+i,n=(n&w.height-1)+a;break}default:throw new Error("Unrecognized UV wrapping mode.")}break;case"affine-npot":{r=u/x,n=y/x;const e=1-Number.EPSILON;r=r<0?e+r:r,n=n<0?e+n:n;const t=p[1&O][1&F];r+=t[0]/w.width,n+=t[1]/w.height,r=w.width*(r<0?0:r>e?e:r),n=w.height*(n<0?0:n>e?e:n)}break;case"ortho":{const e=M-_,t=F-o+1,i=O-_+1,a=p[1&O][1&F];r+=a[0],n+=a[1],r=t*(w.width/g),n=i*(w.height/e),n=w.height-n;break}default:throw new Error("Unknown texture-mapping mode.")}const e=4*(~~r+~~n*w.width);if(f.allowAlphaReject&&255!==w.pixels[e+3])continue;if(f.allowAlphaBlend&&P.stipple_test(f.color.alpha,F,O))continue;re=w.pixels[e+0],ne=w.pixels[e+1],oe=w.pixels[e+2]}else{if(f.allowAlphaBlend&&P.stipple_test(f.color.alpha,F,O))continue;re=f.color.red*te,ne=f.color.green*te,oe=f.color.blue*te}if(re*=te*f.color.unitRange.red,ne*=te*f.color.unitRange.green,oe*=te*f.color.unitRange.blue,!f.bypassPixelBuffer)if(te>1){const t=4*q;e.pixelBuffer8[t+0]=re,e.pixelBuffer8[t+1]=ne,e.pixelBuffer8[t+2]=oe,e.pixelBuffer8[t+3]=255}else e.pixelBuffer32[q]=(255<<24)+(oe<<16)+(ne<<8)+~~re;if(c&&(c[q]=ee),s){const e=l[q];!d.ngon||(e.ngon=t),!d.textureUScaled||(e.textureUScaled=~~r),!d.textureVScaled||(e.textureVScaled=~~n),!d.shade||(e.shade=a/x),!d.worldX||(e.worldX=Z/x),!d.worldY||(e.worldY=U/x),!d.worldZ||(e.worldZ=K/x),!d.normalX||(e.normalX=G/x),!d.normalY||(e.normalY=J/x),!d.normalZ||(e.normalZ=Q/x)}}}y.x+=y.delta.x,y.depth+=y.delta.depth,y.shade+=y.delta.shade,y.u+=y.delta.u,y.v+=y.delta.v,y.invW+=y.delta.invW,y.worldX+=y.delta.worldX,y.worldY+=y.delta.worldY,y.worldZ+=y.delta.worldZ,y.normalX+=y.delta.normalX,y.normalY+=y.delta.normalY,y.normalZ+=y.delta.normalZ,x.x+=x.delta.x,x.depth+=x.delta.depth,x.shade+=x.delta.shade,x.u+=x.delta.u,x.v+=x.delta.v,x.invW+=x.delta.invW,x.worldX+=x.delta.worldX,x.worldY+=x.delta.worldY,x.worldZ+=x.delta.worldZ,x.normalX+=x.delta.normalX,x.normalY+=x.delta.normalY,x.normalZ+=x.delta.normalZ,O===y.bottom-1&&(y=r[++m]),O===x.bottom-1&&(x=n[++b])}return!0}function O({renderContext:e,ngon:t,leftEdges:r,rightEdges:n,numLeftEdges:o,numRightEdges:i}){const a=e.useFullInterpolation,s=e.useFragmentBuffer,d=e.fragments,l=e.fragmentBuffer.data,c=e.pixelBuffer.width,u=e.useDepthBuffer?e.depthBuffer.data:null,f=t.material;let h=0,p=0,w=r[h],g=n[p];if(!o||!i)return;const m=r[0].top,b=r[o-1].bottom;let y=m-1;for(;++y<b;){const o=Math.min(c,Math.max(0,Math.round(w.x))),i=Math.min(c,Math.max(0,Math.ceil(g.x))),m=i-o+1;if(m>0){const r=a?1:w.invW,n=a?1:g.invW,h=a?(g.invW-w.invW)/m:0,p=a?w.invW:1,b=(g.depth/n-w.depth/r)/m,x=w.depth/r,_=(g.shade/n-w.shade/r)/m,v=w.shade/r;let M=o+y*c-1,O=o-1,z=0;for(;++O<i;){const r=x+b*z,n=v+_*z,o=p+h*z;M++,z++;const i=r/o;if(!(u[M]<=i)){const r=f.renderVertexShade?n/o:1,a=f.color.red*r,c=f.color.green*r,h=f.color.blue*r;if(r>1){const t=4*M;e.pixelBuffer8[t+0]=a,e.pixelBuffer8[t+1]=c,e.pixelBuffer8[t+2]=h,e.pixelBuffer8[t+3]=255}else e.pixelBuffer32[M]=(255<<24)+(h<<16)+(c<<8)+~~a;if(u[M]=i,s){const e=l[M];!d.ngon||(e.ngon=t),!d.shade||(e.shade=n/o)}}}}w.x+=w.delta.x,w.depth+=w.delta.depth,w.shade+=w.delta.shade,w.invW+=w.delta.invW,g.x+=g.delta.x,g.depth+=g.delta.depth,g.shade+=g.delta.shade,g.invW+=g.delta.invW,y===w.bottom-1&&(w=r[++h]),y===g.bottom-1&&(g=n[++p])}return!0}function z({renderContext:e,ngon:t,leftEdges:r,rightEdges:n,numLeftEdges:o,numRightEdges:i}){if(!o||!i)return!0;const a=e.useFullInterpolation,s=e.useFragmentBuffer,d=e.fragments,l=e.fragmentBuffer.data,c=e.pixelBuffer.width,u=e.useDepthBuffer?e.depthBuffer.data:null,f=t.material,h=f.texture||null;let p=null,w=0;const g=h.mipLevels.length;w=Math.max(0,Math.min(g-1,Math.round((g-1)*t.mipLevel))),p=h.mipLevels[w];let m=0,b=0,y=r[m],x=n[b];const _=r[0].top,v=r[o-1].bottom;let M=_-1;for(;++M<v;){const o=Math.min(c,Math.max(0,Math.round(y.x))),i=Math.min(c,Math.max(0,Math.ceil(x.x))),h=i-o+1;if(h>0){const r=a?1:y.invW,n=a?1:x.invW,w=a?(x.invW-y.invW)/h:0,g=a?y.invW:1,m=(x.depth/n-y.depth/r)/h,b=y.depth/r,_=(x.shade/n-y.shade/r)/h,v=y.shade/r,O=(x.u/n-y.u/r)/h,z=y.u/r,j=(x.v/n-y.v/r)/h,B=y.v/r;let k=o+M*c-1,S=o-1,W=0;for(;++S<i;){const r=b+m*W,n=v+_*W,o=g+w*W,i=z+O*W,a=B+j*W;k++,W++;const c=r/o;if(u[k]<=c)continue;let h=i/o,y=a/o;switch(f.uvWrapping){case"clamp":{const e=1-Number.EPSILON;h=h<0?e+h:h,y=y<0?e+y:y,h=p.width*(h<0?0:h>e?e:h),y=p.height*(y<0?0:y>e?e:y);break}case"repeat":h=p.width*(h-Math.floor(h)),y=p.height*(y-Math.floor(y)),h&=p.width-1,y&=p.height-1;break;default:throw new Error("Unrecognized UV wrapping mode.")}const x=4*(~~h+~~y*p.width);{const r=f.renderVertexShade?n/o:1,i=p.pixels[x+0]*r,a=p.pixels[x+1]*r,w=p.pixels[x+2]*r;if(r>1){const t=4*k;e.pixelBuffer8[t+0]=i,e.pixelBuffer8[t+1]=a,e.pixelBuffer8[t+2]=w,e.pixelBuffer8[t+3]=255}else e.pixelBuffer32[k]=(255<<24)+(w<<16)+(a<<8)+~~i;if(u[k]=c,s){const e=l[k];!d.ngon||(e.ngon=t),!d.textureUScaled||(e.textureUScaled=~~h),!d.textureVScaled||(e.textureVScaled=~~y),!d.shade||(e.shade=n/o)}}}}y.x+=y.delta.x,y.depth+=y.delta.depth,y.shade+=y.delta.shade,y.u+=y.delta.u,y.v+=y.delta.v,y.invW+=y.delta.invW,x.x+=x.delta.x,x.depth+=x.delta.depth,x.shade+=x.delta.shade,x.u+=x.delta.u,x.v+=x.delta.v,x.invW+=x.delta.invW,M===y.bottom-1&&(y=r[++m]),M===x.bottom-1&&(x=n[++b])}return!0}function j({renderContext:e,ngon:t,leftEdges:r,rightEdges:n,numLeftEdges:o,numRightEdges:i}){if(!o||!i)return!0;const a=e.useFullInterpolation,s=e.useFragmentBuffer,d=e.fragments,l=e.fragmentBuffer.data,c=e.pixelBuffer.width,u=e.useDepthBuffer?e.depthBuffer.data:null,f=t.material,h=f.texture||null;let p=null,w=0;const g=h.mipLevels.length;w=Math.max(0,Math.min(g-1,Math.round((g-1)*t.mipLevel))),p=h.mipLevels[w];let m=0,b=0,y=r[m],x=n[b];const _=r[0].top,v=r[o-1].bottom;let M=_-1;for(;++M<v;){const o=Math.min(c,Math.max(0,Math.round(y.x))),i=Math.min(c,Math.max(0,Math.ceil(x.x))),h=i-o+1;if(h>0){const r=a?1:y.invW,n=a?1:x.invW,w=a?(x.invW-y.invW)/h:0,g=a?y.invW:1,m=(x.depth/n-y.depth/r)/h,b=y.depth/r,_=(x.shade/n-y.shade/r)/h,v=y.shade/r,O=(x.u/n-y.u/r)/h,z=y.u/r,j=(x.v/n-y.v/r)/h,B=y.v/r;let k=o+M*c-1,S=o-1,W=0;for(;++S<i;){const r=b+m*W,n=v+_*W,o=g+w*W,i=z+O*W,a=B+j*W;k++,W++;const c=r/o;if(u[k]<=c)continue;let h=i/o,y=a/o;switch(f.uvWrapping){case"clamp":{const e=1-Number.EPSILON;h=h<0?e+h:h,y=y<0?e+y:y,h=p.width*(h<0?0:h>e?e:h),y=p.height*(y<0?0:y>e?e:y);break}case"repeat":{h=p.width*(h-Math.floor(h)),y=p.height*(y-Math.floor(y));const e=Math.abs(h),t=Math.abs(y),r=e-~~e,n=t-~~t;h=(h&p.width-1)+r,y=(y&p.height-1)+n;break}default:throw new Error("Unrecognized UV wrapping mode.")}const x=4*(~~h+~~y*p.width);{const r=f.renderVertexShade?n/o:1,i=p.pixels[x+0]*r*f.color.unitRange.red,a=p.pixels[x+1]*r*f.color.unitRange.green,w=p.pixels[x+2]*r*f.color.unitRange.blue;if(r>1){const t=4*k;e.pixelBuffer8[t+0]=i,e.pixelBuffer8[t+1]=a,e.pixelBuffer8[t+2]=w,e.pixelBuffer8[t+3]=255}else e.pixelBuffer32[k]=(255<<24)+(w<<16)+(a<<8)+~~i;if(u[k]=c,s){const e=l[k];!d.ngon||(e.ngon=t),!d.textureUScaled||(e.textureUScaled=~~h),!d.textureVScaled||(e.textureVScaled=~~y),!d.shade||(e.shade=n/o)}}}}y.x+=y.delta.x,y.depth+=y.delta.depth,y.shade+=y.delta.shade,y.u+=y.delta.u,y.v+=y.delta.v,y.invW+=y.delta.invW,x.x+=x.delta.x,x.depth+=x.delta.depth,x.shade+=x.delta.shade,x.u+=x.delta.u,x.v+=x.delta.v,x.invW+=x.delta.invW,M===y.bottom-1&&(y=r[++m]),M===x.bottom-1&&(x=n[++b])}return!0}function B(e,t=d(),r=d(),n={}){const o=n.wireframeColor;if(n.allowAlphaReject&&o.alpha<255)return!0;const i=e.useDepthBuffer?e.depthBuffer.data:null,a=e.pixelBuffer.width,s=e.pixelBuffer.height,l=e.useFragmentBuffer,c=e.fragmentBuffer.data,u=e.fragments;let f;l&&u.ngon&&(f=Rngon.ngon([t,r],n));const h=Math.floor(t.x),p=Math.floor(t.y),w=Math.floor(r.x),g=Math.ceil(r.y);let m=Math.ceil(Math.sqrt((w-h)**2+(g-p)**2));const b=(w-h)/m,y=(g-p)/m,x=t.z/e.farPlaneDistance,_=(r.z/e.farPlaneDistance-x)/m,v=n.renderVertexShade?t.shade:1,M=((n.renderVertexShade?r.shade:1)-v)/m;let O=0;for(;m--;){const t=h+b*O,r=p+y*O,d=x+_*O,w=v+M*O;O++;const g=~~t,m=~~r,z=g+m*a;if(g>=0&&m>=0&&g<a&&m<s&&(!i||i[z]>=d)){const t=o.red*w,r=o.green*w,a=o.blue*w;if(!n.bypassPixelBuffer)if(w>1){const n=4*z;e.pixelBuffer8[n+0]=t,e.pixelBuffer8[n+1]=r,e.pixelBuffer8[n+2]=a,e.pixelBuffer8[n+3]=255}else e.pixelBuffer32[z]=(255<<24)+(a<<16)+(r<<8)+~~t;i&&(i[z]=d),l&&u.ngon&&(c[z].ngon=f)}}return!0}function k(e,t=d(),r=d(),n={}){const o=e.pixelBuffer.width,i=e.pixelBuffer.height,a=Math.floor(t.x),s=Math.floor(t.y),l=Math.floor(r.x),c=Math.ceil(r.y);let u=Math.ceil(Math.sqrt((l-a)**2+(c-s)**2));const f=(l-a)/u,h=(c-s)/u,p=(255<<24)+(n.color.blue<<16)+(n.color.green<<8)+~~n.color.red;let w=0;for(;u--;){const t=a+f*w,r=s+h*w;w++;const n=~~t,d=~~r;if(n>=0&&d>=0&&n<o&&d<i){const t=n+d*o;e.pixelBuffer32[t]=p}}return!0}function S(e,t=d(),r={}){const n=e.useDepthBuffer?e.depthBuffer.data:null,o=e.pixelBuffer.width,i=Math.floor(t.x)+Math.floor(t.y)*o,a=t.z/e.farPlaneDistance,s=r.color;if(!(n&&n[i]<=a)){{const o=t.shade;if(!r.bypassPixelBuffer){const t=s.red*o,r=s.green*o,n=s.blue*o;if(o>1){const o=4*i;e.pixelBuffer8[o+0]=t,e.pixelBuffer8[o+1]=r,e.pixelBuffer8[o+2]=n,e.pixelBuffer8[o+3]=255}else e.pixelBuffer32[i]=(255<<24)+(n<<16)+(r<<8)+~~t}n&&(n[i]=a)}return!0}}function W(e,t=d(),r=p()){return e.pixelBuffer32[Math.floor(t.x)+Math.floor(t.y)*e.pixelBuffer.width]=(255<<24)+(r.blue<<16)+(r.green<<8)+~~r.red,!0}const I=500,$=new Array(I),R=new Array(I),A=new Array(I).fill().map((()=>({top:void 0,bottom:void 0,start:{},delta:{}}))),E=new Array(I).fill().map((()=>({top:void 0,bottom:void 0,start:{},delta:{}}))),C=(e,t)=>e.y===t.y?0:e.y<t.y?-1:1;function P(e){for(const t of e.screenSpaceNgons)switch(r?.(t.vertices.length,"Encountered an n-gon with 0 vertices"),t.vertices.length){case 0:continue;case 1:P.point(e,t.vertices[0],t.material);break;case 2:P.line(e,t.vertices[0],t.vertices[1],t.material);break;default:P.polygon(e,t)}}P.polygon=function(e,t=b()){r?.(t.vertices.length>=3,"Polygons must have 3 or more vertices"),r?.(t.vertices.length<I,"Overflowing the vertex buffer");const n=e.useFragmentBuffer,o=e.fragments,i=e.useDepthBuffer?e.depthBuffer.data:null,a=e.pixelBuffer.width,s=e.pixelBuffer.height,d=t.material;let l=0,c=0,u=0,f=0;!function(){t.vertices.sort(C);const e=t.vertices[0],r=t.vertices[t.vertices.length-1];$[l++]=e,R[c++]=e;for(let i=1;i<t.vertices.length-1;i++){const a=(n=e.x,o=r.x,n+(t.vertices[i].y-e.y)/(r.y-e.y)*(o-n));t.vertices[i].x>=a?R[c++]=t.vertices[i]:$[l++]=t.vertices[i]}var n,o;$[l++]=r,R[c++]=r}(),function(){for(let e=1;e<l;e++)r($[e-1],$[e],!0);for(let e=1;e<c;e++)r(R[e-1],R[e],!1);function r(r,o,i){const l=Math.min(s,Math.max(0,Math.floor(r.y))),c=Math.min(s,Math.max(0,Math.floor(o.y))),h=c-l;if(0===h)return;const p=Math.min(a,Math.max(0,Math.floor(r.x))),w=(Math.min(a,Math.max(0,Math.floor(o.x)))-p)/h,g=d.texture?r.u:1,m=d.texture?1-r.v:1,b=d.texture?o.u:1,y=d.texture?1-o.v:1,x=r.w,_=o.w,v=r.z+t.material.depthOffset,M=o.z+t.material.depthOffset,O=i?A[u++]:E[f++];O.top=l,O.bottom=c,O.x=p,O.delta.x=w,O.depth=v/e.farPlaneDistance/x,O.delta.depth=(M/e.farPlaneDistance/_-O.depth)/h,O.shade=r.shade/x,O.delta.shade=(o.shade/_-O.shade)/h,O.u=g/x,O.delta.u=(b/_-O.u)/h,O.v=m/x,O.delta.v=(y/_-O.v)/h,O.invW=1/x,O.delta.invW=(1/_-O.invW)/h,n&&(O.worldX=r.worldX/x,O.delta.worldX=(o.worldX/_-O.worldX)/h,O.worldY=r.worldY/x,O.delta.worldY=(o.worldY/_-O.worldY)/h,O.worldZ=r.worldZ/x,O.delta.worldZ=(o.worldZ/_-O.worldZ)/h,O.normalX=r.normalX/x,O.delta.normalX=(o.normalX/_-O.normalX)/h,O.normalY=r.normalY/x,O.delta.normalY=(o.normalY/_-O.normalY)/h,O.normalZ=r.normalZ/x,O.delta.normalZ=(o.normalZ/_-O.normalZ)/h)}}();const h={renderContext:e,ngon:t,leftEdges:A,rightEdges:E,numLeftEdges:u,numRightEdges:f};if(d.hasFill&&!e.pipeline.raster_path?.(h)){let e=M;d.bypassPixelBuffer||!d.texture||!i||o.worldX||o.worldY||o.worldZ||o.normalX||o.normalY||o.normalZ||d.allowAlphaReject||d.allowAlphaBlend||"affine"!==d.textureMapping||"dither"===d.textureFiltering?d.bypassPixelBuffer||d.texture||!i||o.worldX||o.worldY||o.worldZ||o.normalX||o.normalY||o.normalZ||d.allowAlphaReject||d.allowAlphaBlend||(e=O):e=255===d.color.red&&255===d.color.green&&255===d.color.blue&&"none"===d.textureFiltering?z:j,e(h)}if(d.hasWireframe){for(let t=1;t<l;t++)P.line(e,$[t-1],$[t],d);for(let t=1;t<c;t++)P.line(e,R[t-1],R[t],d)}},P.line=function(e,t=d(),r=d(),n={}){const o=e.pixelBuffer.width,i=e.pixelBuffer.height;if(!(t.x<0&&r.x<0||t.x>=o&&r.x>=o||t.y<0&&r.y<0||t.y>=i&&r.y<i)){let o=B;n.bypassPixelBuffer||255!==n.color.alpha||e.useFragmentBuffer||e.useDepthBuffer||n.renderVertexShade&&(1!==t.shade||1!==r.shade)||(o=k),o(e,t,r,n)}},P.point=function(e,t=d(),r={}){if(r.allowAlphaReject&&255!=r.color.alpha)return;const n=e.pixelBuffer.width,o=e.pixelBuffer.height;if(!(t.x<0||t.y<0||t.x>=n||t.y>=o)){let n=S;r.bypassPixelBuffer||e.useDepthBuffer||1!==t.shade||(n=W),n(e,t,r)}},P.stipple_test=function(){const e=[{width:8,height:6,pixels:[0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},{width:4,height:4,pixels:[0,1,0,1,1,1,1,1,1,0,1,0,1,1,1,1]},{width:2,height:2,pixels:[1,0,0,1]}];for(let t=e.length-2;t>=0;t--)e.push({width:e[t].width,height:e[t].height,pixels:e[t].pixels.map((e=>Number(!e)))});return function(t,r,n){if(t<=0)return!0;if(t>=255)return!1;{const o=Math.floor(t/(256/e.length)),i=e[o],a=r%i.width+n%i.height*i.width;if(i.pixels[a])return!0}return!1}}();const L={translate:u(0,0,0),rotate:u(0,0,0),scale:u(1,1,1)},D={where:"in arguments to Rngon::mesh()",properties:{ngons:[["Ngon"]],transform:{subschema:{properties:{translate:{optional:!0,type:["Vector"]},rotate:{optional:!0,type:["Vector"]},scale:{optional:!0,type:["Vector"]}}}}}},T={where:"in the return value of Rngon::mesh()",allowAdditionalProperties:!0,properties:{$constructor:{value:"Mesh"},ngons:[["Ngon"]],rotate:["Vector"],translate:["Vector"],scale:["Vector"]}};function H(e,t){r?.(["flat","gouraud"].includes(e.material.vertexShading),`Unrecognized shading mode: ${e.material.vertexShading}`);const n=u();let o=e.material.ambientLightLevel;for(let t=0;t<e.vertices.length;t++)e.vertices[t].shade=e.material.ambientLightLevel;let i=0,a=0,s=0;if("flat"===e.material.vertexShading){for(const t of e.vertices)i+=t.x,a+=t.y,s+=t.z;i/=e.vertices.length,a/=e.vertices.length,s/=e.vertices.length}for(const r of t.lights)if("gouraud"===e.material.vertexShading)for(let t=0;t<e.vertices.length;t++){const o=e.vertices[t],i=1/(1+Math.sqrt((o.x-r.x)**2+(o.y-r.y)**2+(o.z-r.z)**2));n.x=r.x-o.x,n.y=r.y-o.y,n.z=r.z-o.z,u.normalize(n);const a=e.vertices.length<3?1:u.dot(e.vertexNormals[t],n),s=Math.max(0,Math.min(1,a));o.shade=Math.max(o.shade,Math.min(1,s*i*r.intensity))}else if("flat"===e.material.vertexShading){const t=1/(1+Math.sqrt((i-r.x)**2+(a-r.y)**2+(s-r.z)**2));n.x=r.x-i,n.y=r.y-a,n.z=r.z-s,u.normalize(n);const d=e.vertices.length<3?1:u.dot(e.normal,n),l=Math.max(0,Math.min(1,d));o=Math.max(o,Math.min(1,l*t*r.intensity))}if("flat"===e.material.vertexShading)for(let t=0;t<e.vertices.length;t++)e.vertices[t].shade=o}const N={where:"in arguments to Rngon::surface()",properties:{canvasElement:["HTMLPalettedCanvasElement","HTMLCanvasElement","undefined"],renderContext:["Context"]}},Y={where:"in the return value of Rngon::surface()",properties:{$constructor:{value:"Surface"},width:["number"],height:["number"],display_meshes:["function"],is_in_view:["function"]}},V="default";function q(e=void 0){return void 0===e&&(e=V),q.list[e]||(q.list[e]=q.instance())}q.instance=function(){return{$constructor:"Context",contextName:void 0,pipeline:{ngon_sorter:void 0,transform_clip_lighter:void 0,surface_wiper:void 0,rasterizer:void 0,vertex_shader:void 0,pixel_shader:void 0,canvas_shader:void 0,raster_path:void 0},resolution:{width:void 0,height:void 0},pixelBuffer:void 0,pixelBuffer8:void 0,pixelBuffer32:void 0,useDepthBuffer:!1,depthBuffer:{width:0,height:0,data:void 0,resize(e,t){this.width=e,this.height=t,this.data=new Float64Array(e*t)},clear(){this.data.fill(1)}},useFragmentBuffer:!1,fragmentBuffer:{width:0,height:0,data:void 0,resize(e,t){this.width=e,this.height=t,this.data=new Array(e*t).fill().map((e=>({})))}},fragments:{ngon:!0,textureUScaled:!0,textureVScaled:!0,shade:!0,worldX:!0,worldY:!0,worldZ:!0,normalX:!0,normalY:!0,normalZ:!0},usePixelShader:!1,pixel_shader:void 0,useVertexShader:!1,vertex_shader:void 0,useCanvasShader:!1,canvas_shader:void 0,renderScale:void 0,useFullInterpolation:!0,nearPlaneDistance:1,farPlaneDistance:1,fov:45,cameraDirection:void 0,cameraPosition:void 0,allowWindowAlert:!1,screenSpaceNgons:[],ngonCache:{count:0,ngons:[]},vertexCache:{count:0,vertices:[]},vertexNormalCache:{count:0,normals:[]},lights:[]}},q.list={[V]:q.instance()};const F={cameraPosition:u(0,0,0),cameraDirection:u(0,0,0),context:void 0,resolution:1,fov:43,nearPlane:1,farPlane:1e3,useDepthBuffer:!0,useFragmentBuffer:!1,useBackfaceCulling:!1,useFullInterpolation:!0,fragments:void 0,hibernateWhenTargetNotVisible:!0,lights:[]},X={ngonSorter:function(e){e.useDepthBuffer&&e.screenSpaceNgons.sort(((e,t)=>{const r=e.vertices.reduce(((e,t)=>e+t.z),0)/e.vertices.length,n=t.vertices.reduce(((e,t)=>e+t.z),0)/t.vertices.length;return r===n?0:r>n?1:-1}))},surfaceWiper:function(e){e.pixelBuffer.data.fill(0),e.useDepthBuffer&&e.depthBuffer.clear()},rasterizer:P,transformClipLighter:function({renderContext:e,mesh:t,cameraMatrix:r,perspectiveMatrix:n,screenSpaceMatrix:o}={}){const a={x:0,y:0,z:0},s=e.ngonCache,d=e.vertexCache,l=e.vertexNormalCache,c=i.multiply(n,r),f=function(e){const t=i.translating(e.translate.x,e.translate.y,e.translate.z),r=i.rotating(e.rotate.x,e.rotate.y,e.rotate.z),n=i.scaling(e.scale.x,e.scale.y,e.scale.z);return i.multiply(i.multiply(t,r),n)}(t);for(const r of t.ngons){if(!r.material.hasWireframe&&r.material.allowAlphaReject&&r.material.color.alpha<=0)continue;const t=s.ngons[s.count++];t.vertices.length=0;for(let e=0;e<r.vertices.length;e++){const n=r.vertices[e],o=t.vertices[e]=d.vertices[d.count++];o.x=n.x,o.y=n.y,o.z=n.z,o.u=n.u,o.v=n.v,o.w=n.w,o.shade=n.shade,t.vertexNormals[e]=l.normals[l.count++],t.vertexNormals[e].x=r.vertexNormals[e].x,t.vertexNormals[e].y=r.vertexNormals[e].y,t.vertexNormals[e].z=r.vertexNormals[e].z}if(t.material=r.material,t.normal.x=r.normal.x,t.normal.y=r.normal.y,t.normal.z=r.normal.z,t.mipLevel=r.mipLevel,b.transform(t,f),e.useFragmentBuffer)for(let e=0;e<t.vertices.length;e++)t.vertices[e].worldX=t.vertices[e].x,t.vertices[e].worldY=t.vertices[e].y,t.vertices[e].worldZ=t.vertices[e].z;for(let e=0;e<t.vertices.length;e++)u.transform(t.vertexNormals[e],f),u.normalize(t.vertexNormals[e]),t.vertices[e].normalX=t.vertexNormals[e].x,t.vertices[e].normalY=t.vertexNormals[e].y,t.vertices[e].normalZ=t.vertexNormals[e].z;if(u.transform(t.normal,f),u.normalize(t.normal),e.useBackfaceCulling&&t.vertices.length>2&&!t.material.isTwoSided&&(a.x=t.vertices[0].x-e.cameraPosition.x,a.y=t.vertices[0].y-e.cameraPosition.y,a.z=t.vertices[0].z-e.cameraPosition.z,u.dot(t.normal,a)>=0))s.count--;else if("none"!==t.material.vertexShading&&H(t,e),e.useVertexShader&&e.pipeline.vertex_shader(t,e),!t.material.isInScreenSpace){if(b.transform(t,c),b.clip_to_viewport(t),!t.vertices.length){s.count--;continue}b.transform(t,o),b.perspective_divide(t)}}e.screenSpaceNgons=s.ngons.slice(0,s.count)},pixelShader:void 0,vertexShader:void 0,canvasShader:void 0,rasterPath:void 0},Z={where:"in arguments to Rngon::render()",properties:{target:["HTMLCanvasElement","string","undefined"],meshes:[["Mesh"],"undefined"],options:["object"],pipeline:["object"]}},U={where:"in render({options})",properties:{cameraPosition:["Vector"],cameraDirection:["Vector"],context:["string","number","undefined"],resolution:["number","object"],fov:["number"],nearPlane:["number"],farPlane:["number"],useDepthBuffer:["boolean"],useFragmentBuffer:["boolean"],useBackfaceCulling:["boolean"],useFullInterpolation:["boolean"],fragments:["object","undefined"],hibernateWhenTargetNotVisible:["boolean"],lights:[["Light","object"]]}},K={where:"in render({pipeline})",properties:{ngonSorter:["undefined","function"],surfaceWiper:["undefined","null","function"],rasterizer:["undefined","null","function"],transformClipLighter:["undefined","null","function"],pixelShader:["undefined","function"],vertexShader:["undefined","function"],canvasShader:["undefined","function"],rasterPath:["undefined","function"]}},G={where:"in arguments to Rngon::light()",properties:{x:["number"],y:["number"],z:["number"],options:{subschema:{allowAdditionalProperties:!0,properties:{intensity:["number"]}}}}},J={where:"in the return value of Rngon::light()",allowAdditionalProperties:!0,properties:{$constructor:{value:"Light"},x:["number"],y:["number"],z:["number"]}},Q={width:1,height:1,pixels:void 0,encoding:"none",channels:"rgba:8+8+8+8"},ee={arguments:{where:"in arguments to Rngon::texture()",allowAdditionalProperties:!0,properties:{pixels:["Uint8ClampedArray",["number"],"string"],width:{type:["number"],value(e){if(e<1||e>32768)return"Texture width must be in the range [1, 32768]"}},height:{type:["number"],value(e){if(e<1||e>32768)return"Texture height must be in the range [1, 32768]"}},encoding:{type:["string"],value(e){const t=["none","base64"];if(!t.includes(e))return`Texture encoding must be one of ${t.join(", ")}`}},channels:{type:["string"],value(e){const t=["binary","rgba:5+5+5+1","rgba:8+8+8+8"];if(!t.includes(e))return`Texture pixel layout must be one of ${t.join(", ")}`}}}},interface:{where:"in the return value of Rngon::texture()",allowAdditionalProperties:!0,properties:{$constructor:{value:"Texture"},width:["number"],height:["number"],pixels:["Uint8ClampedArray"],mipLevels:[["object","Texture"]]}}};function te(e={}){e=structuredClone(e);for(const t of Object.keys(Q))e.hasOwnProperty(t)||(e[t]=Q[t]);void 0===e.pixels&&(e.pixels=new Array(e.width*e.height*4)),n?.(e,ee.arguments),function(e){if("none"===e.encoding)r?.("rgba:8+8+8+8"===e.channels&&e.pixels.length===e.width*e.height*4,"Unencoded pixel data must be provided in 'rgba:8+8+8+8' format."),e.pixels instanceof Uint8ClampedArray||(e.pixels=new Uint8ClampedArray(e.pixels));else if("base64"===e.encoding){const t=atob(e.pixels);switch(e.pixels=new Uint8ClampedArray(e.width*e.height*4),e.channels){case"rgba:8+8+8+8":r?.(t.length===e.width*e.height*4,"Unexpected data length for a Base64-encoded texture; expected 4 bytes per pixel.");for(let r=0;r<e.width*e.height*4;r++)e.pixels[r]=t.charCodeAt(r);break;case"rgba:5+5+5+1":{r?.(t.length===e.width*e.height*2,"Unexpected data length for a Base64-encoded texture; expected 2 bytes per pixel.");let n=0;for(let r=0;r<e.width*e.height*2;r+=2){const o=t.charCodeAt(r)+(t.charCodeAt(r+1)<<8);e.pixels[n++]=8*(31&o),e.pixels[n++]=8*(o>>5&31),e.pixels[n++]=8*(o>>10&31),e.pixels[n++]=255*(o>>15&1)}break}case"binary":r?.(t.length===e.width*e.height,"Unexpected data length for a Base64-encoded texture; expected 1 byte per pixel.");for(let r=0;r<e.width*e.height;r++){const n=4*r,o=255*t.charCodeAt(r);e.pixels[n+0]=o,e.pixels[n+1]=o,e.pixels[n+2]=o,e.pixels[n+3]=o}break;default:throw new Error("Unrecognized value for texture 'channels' attribute.")}}else if("none"!==e.encoding)throw new Error("Unknown texture data encoding '"+e.encoding+"'.");r?.(e.pixels instanceof Uint8ClampedArray,"Expected texture data to be output as a Uint8ClampedArray."),r?.(e.pixels.length===e.width*e.height*4,"The texture's pixel array size doesn't match its width and height.")}(e);const t={$constructor:"Texture",regenerate_mipmaps:re,...e};return t.regenerate_mipmaps(),n?.(t,ee.interface),t}function re(){if(r?.(this.hasOwnProperty("$constructor")&&"Texture"===this.$constructor,"Expected 'this' to point to a Texture"),this.mipLevels=[this],1!==this.width||1!==this.height)for(let e=1;;e++){const t=Math.max(1,Math.floor(this.width/Math.pow(2,e))),n=Math.max(1,Math.floor(this.height/Math.pow(2,e))),o=[];{const e=this.width/t,r=this.height/n;for(let i=0;i<n;i++)for(let n=0;n<t;n++){const a=4*(n+i*t),s=4*(Math.floor(n*e)+Math.floor(i*r)*this.width);for(let e=0;e<4;e++)o[a+e]=this.pixels[s+e]}}if(this.mipLevels.push({width:t,height:n,pixels:o}),1===t&&1===n){r?.(this.mipLevels.length>0,"Failed to generate mip levels for a texture.");break}}}te.load=async function(e){try{const t=await fetch(e);return te(await t.json())}catch(t){throw new Error(`Failed to create a texture with data from file '${e}'. ${t}`)}};const ne={render:{options:F,pipeline:X},mesh:{transform:L},texture:Q,ngon:{material:w},context:V},oe={version:Object.freeze({major:1,minor:0,isProductionBuild:!0}),default:ne,render:function({target:e,meshes:t,options:o={},pipeline:a={}}={}){n?.({target:e,meshes:t,options:o,pipeline:a},Z);const s={renderWidth:0,renderHeight:0,numNgonsRendered:0,totalRenderTimeMs:performance.now()};o=Object.freeze({...F,...o});for(const e of Object.keys(X))void 0===a[e]&&(a[e]=X[e]);if(n?.(o,U),n?.(a,K),void 0===e)r?.("object"==typeof o.resolution&&"number"==typeof o.resolution.width&&"number"==typeof o.resolution.height,"No on-screen render target given. Off-screen rendering requires `options.resolution` to be an object of the form {width, height}.");else if("string"==typeof e){const t=e;e=document.getElementById(e),r?.(e instanceof HTMLCanvasElement,`The render target <canvas id="${t}"> doesn't exist in the document.`)}else r?.(e instanceof HTMLCanvasElement,`The render target ${e} isn't an instance of HTMLCanvasElement.`);const l=function(e={},t={}){const r=q(e.context);if(r.contextName=e.context,r.useDepthBuffer=Boolean(e.useDepthBuffer),r.useBackfaceCulling=Boolean(e.useBackfaceCulling),r.lights=e.lights,r.renderScale="number"==typeof e.resolution?e.resolution:void 0,r.renderWidth=e.resolution.width,r.renderHeight=e.resolution.height,r.nearPlaneDistance=e.nearPlane,r.farPlaneDistance=e.farPlane,r.fov=e.fov,r.cameraDirection=e.cameraDirection,r.cameraPosition=e.cameraPosition,r.useFullInterpolation=Boolean(e.useFullInterpolation),r.useFragmentBuffer=Boolean(e.useFragmentBuffer||r.usePixelShader&&r.pixel_shader?.toString().match(/{(.+)?}/)[1].includes("fragmentBuffer")),"object"==typeof e.fragments)for(const t of Object.keys(r.fragments))r.fragments[t]=e.fragments[t]??!1;else for(const e of Object.keys(r.fragments))r.fragments[e]=r.useFragmentBuffer;return r.pipeline.ngon_sorter=t.ngonSorter,r.pipeline.rasterizer=t.rasterizer,r.pipeline.transform_clip_lighter=t.transformClipLighter,r.pipeline.surface_wiper=t.surfaceWiper,r.usePixelShader=Boolean(t.pixelShader),r.pipeline.pixel_shader=t.pixelShader,r.useVertexShader=Boolean(t.vertexShader),r.pipeline.vertex_shader=t.vertexShader,r.useCanvasShader=Boolean(t.canvasShader),r.pipeline.canvas_shader=t.canvasShader,r.pipeline.raster_path=t.rasterPath,r}(o,a);{const a=function(e,t){n?.({canvasElement:e,renderContext:t},N);const o=void 0===e;let a,s,l;try{({surfaceWidth:a,surfaceHeight:s,canvasElement:e,canvasContext:l}=o?function(e){return{surfaceWidth:e.renderWidth,surfaceHeight:e.renderHeight,canvasContext:{createImageData:function(e,t){return new ImageData(e,t)}}}}(t):function(e,t){const n=t?.getContext("2d");let o,i;return r?.(t instanceof Element&&n,"Invalid canvas element"),"number"==typeof e.renderScale?(o=Math.floor(parseInt(window.getComputedStyle(t).getPropertyValue("width"))*e.renderScale),i=Math.floor(parseInt(window.getComputedStyle(t).getPropertyValue("height"))*e.renderScale),r?.(o>0&&i>0,"Failed to query the dimensions of the target canvas")):(r?.("number"==typeof e.renderWidth&&"number"==typeof e.renderHeight,"Invalid render resolution"),o=e.renderWidth,i=e.renderHeight),t.setAttribute("width",o),t.setAttribute("height",i),{surfaceWidth:o,surfaceHeight:i,canvasElement:t,canvasContext:n}}(t,e)),function(e,t,r,n){void 0!==t.pixelBuffer&&t.pixelBuffer.width==r&&t.pixelBuffer.height==n||(t.pixelBuffer=e.createImageData(r,n),t.pixelBuffer8=new Uint8ClampedArray(t.pixelBuffer.data.buffer),t.pixelBuffer32=new Uint32Array(t.pixelBuffer.data.buffer)),!t.useFragmentBuffer||t.fragmentBuffer.width==r&&t.fragmentBuffer.height==n||t.fragmentBuffer.resize(r,n),!t.useDepthBuffer||t.depthBuffer.width==r&&t.depthBuffer.height==n&&t.depthBuffer.data.length||t.depthBuffer.resize(r,n)}(l,t,a,s)}catch(e){return console.error(e),null}const c=i.multiply(i.rotating(t.cameraDirection.x,t.cameraDirection.y,t.cameraDirection.z),i.translating(-t.cameraPosition.x,-t.cameraPosition.y,-t.cameraPosition.z)),f=function(e=0,t=0,r=0,n=0){const o=Math.tan(e/2),a=r-n;return i(1/(o*t),0,0,0,0,1/o,0,0,0,0,(-r-n)/a,1,0,0,2*n*(r/a),0)}(t.fov*(Math.PI/180),a/s,t.nearPlaneDistance,t.farPlaneDistance),h=function(e=0,t=0){const r=e/2,n=t/2;return i(r,0,0,0,0,-n,0,0,0,0,1,0,r-.5,n-.5,0,1)}(a+1,s+1),p={$constructor:"Surface",width:a,height:s,display_meshes:function(e=[]){if(t.pipeline.surface_wiper?.(t),e.length){if(function(e,t=[b()]){r?.(t instanceof Array,"Invalid arguments to n-gon cache initialization.");const n=e.vertexCache,o=e.vertexNormalCache;let i=0;for(const e of t)for(const t of e.ngons)i+=t.vertices.length;if(!n||!n.vertices.length||n.vertices.length<i){const e=i-n.vertices.length;n.vertices.push(...new Array(e).fill().map((e=>d())))}if(n.count=0,!o||!o.normals.length||o.normals.length<i){const e=i-o.normals.length;o.normals.push(...new Array(e).fill().map((e=>u())))}o.count=0}(t,e),function(e,t=[b()]){r?.(t instanceof Array,"Invalid arguments to n-gon cache initialization.");const n=e.ngonCache,o=t.reduce(((e,t)=>e+t.ngons.length),0);if(!n||!n.ngons.length||n.ngons.length<o){const e=o-n.ngons.length;n.ngons.push(...new Array(e).fill().map((e=>b())))}n.count=0}(t,e),t.pipeline.transform_clip_lighter)for(const r of e)t.pipeline.transform_clip_lighter({renderContext:t,mesh:r,cameraMatrix:c,perspectiveMatrix:f,screenSpaceMatrix:h});t.pipeline.ngon_sorter?.(t),function(e){for(const t of e)if(t.material.texture&&"affine"===t.material.textureMapping){let e=!(t.material.texture.width&t.material.texture.width-1),r=!(t.material.texture.height&t.material.texture.height-1);0===t.material.texture.width&&(e=!1),0===t.material.texture.height&&(r=!1),e&&r||(t.material.textureMapping="affine-npot")}}(t.screenSpaceNgons)}t.pipeline.rasterizer?.(t),t.usePixelShader&&t.pipeline.pixel_shader(t),o||(t.useCanvasShader?t.pipeline.canvas_shader(l,t.pixelBuffer):l.putImageData(t.pixelBuffer,0,0))},is_in_view:function(){if(o)return!0;const t=window.innerHeight,r=e.getBoundingClientRect();return r.top>-r.height&&r.top<t}};return n?.(p,Y),p}(e,l);l.resolution.width=s.renderWidth=a.width,l.resolution.height=s.renderHeight=a.height,!a||o.hibernateWhenTargetNotVisible&&!a.is_in_view()||(a.display_meshes(t),s.numNgonsRendered=l.screenSpaceNgons.length)}return s.totalRenderTimeMs=performance.now()-s.totalRenderTimeMs,s},color:p,context:q.list,light:function(e=0,t=0,r=0,o={}){n?.({x:e,y:t,z:r,options:o},G);const i={$constructor:"Light",x:e,y:t,z:r,...o};return n?.(i,J),i},mesh:function(e=[b()],t={}){n?.({ngons:e,transform:t},D);const r={$constructor:"Mesh",ngons:e,...structuredClone(L),...t};return n?.(r,T),r},matrix:i,ngon:b,texture:te,vector:u,vertex:d};var ie=self;for(var ae in t)ie[ae]=t[ae];t.__esModule&&Object.defineProperty(ie,"__esModule",{value:!0})})()},439:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Aw:()=>widget_contains_child,Hg:()=>mount_widget,Hq:()=>transformed_recursive_mesh,_$:()=>create_widget,ud:()=>recurse_descendant_widgets});var _debug_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(960);function create_widget(...e){let t,r;"string"==typeof e[0]?(t=e[0],r=e[1]):(r=e[0],_debug_js__WEBPACK_IMPORTED_MODULE_0__.Y?.assert(void 0===e[1])),_debug_js__WEBPACK_IMPORTED_MODULE_0__.Y?.assert("function"==typeof r),r._name=t;const n=(e,t)=>n=>mount_widget({mount_fn:r,parentWidget:n,mountOptions:e,renderOptions:t});if(void 0===t)return r._name="anonymous",n;_debug_js__WEBPACK_IMPORTED_MODULE_0__.Y?.assert(!w95.widget.hasOwnProperty(t)),w95.widget[t]=n}function mount_widget({mount_fn,mountOptions={},renderOptions={},parentWidget}={}){w95.debug?.assert("function"==typeof mount_fn),w95.debug?.assert(void 0===parentWidget||"w95-widget"===parentWidget._what),w95.debug?.assert(["function","object"].includes(typeof renderOptions)),w95.debug?.assert(["function","object"].includes(typeof mountOptions)),w95.debug?.assert(["function","undefined"].includes(typeof mountOptions.Mounted)),w95.debug?.assert(["function","undefined"].includes(typeof mountOptions.Closed)),w95.debug?.assert(["function","undefined"].includes(typeof mountOptions.Opened)),w95.debug?.assert(["function","undefined"].includes(typeof mountOptions.BeforeUnmount)),w95.debug?.assert(["function","undefined"].includes(typeof mountOptions.Form)),w95.debug?.assert(["function","undefined"].includes(typeof mountOptions.App)),w95.debug?.assert(["function","undefined"].includes(typeof mountOptions.Event)),w95.debug?.assert(["function","undefined"].includes(typeof mountOptions.Message));const expandedOptions="function"==typeof mountOptions?mountOptions():mountOptions,expandedArgs="function"==typeof renderOptions?renderOptions():renderOptions;expandedOptions.isDisabled=parentWidget?._disabled||expandedOptions.isDisabled,["x","y","width","height"].forEach((key=>{if("string"==typeof expandedOptions[key]){["width","height"].includes(key)&&expandedOptions[key].includes("%")&&(expandedOptions[key]=expandedOptions[key].replace(/([0-9]+)%/g,((e,t)=>parentWidget[key]*(t/100))));const parent="dynamicWrapper"===parentWidget._type?parentWidget._parent:parentWidget;expandedOptions[key]=~~eval(expandedOptions[key].replace(/pw/g,parent.width).replace(/ph/g,parent.height))}})),mount_fn.state&&w95.state.use(mount_fn.state,parentWidget);const stateStartIdx=w95.state.head(expandedArgs.reserveState),widgetInterface=mount_fn(expandedOptions);{w95.debug?.assert("object"==typeof widgetInterface),widgetInterface.$=e=>widgetInterface.$descendants.find((t=>t.widget.$name===e)).widget,widgetInterface.$name=expandedOptions.$name,widgetInterface.$app=w95.state.app;const e=widgetInterface.Form||widgetInterface.App;w95.debug?.assert("function"==typeof e);const t=[e.call(widgetInterface)].flat();widgetInterface.$arguments=expandedOptions,widgetInterface._what="w95-widget",widgetInterface._type=mount_fn.name||mount_fn._name,widgetInterface._parent=parentWidget,widgetInterface._mesh=t.filter((e=>"Ngon"===e?.$constructor)),widgetInterface._hideMesh=expandedArgs.hideIf||!1,widgetInterface._stateStartIdx=stateStartIdx,widgetInterface._remountRequested=!1,widgetInterface._rerenderRequested=!1,widgetInterface._autofocus=widgetInterface.autofocus,widgetInterface._disabled=mountOptions.isDisabled,widgetInterface._zIndex=(()=>{switch(widgetInterface._type){case"dialog":return 100;case"menuBar":case"menuAction":case"menuSeparator":case"menu":return 1;case"dropdownBox":case"dropdownBoxList":case"dropdownBoxItem":return 2;case"desktopIcon":return 3;default:return 4}})(),widgetInterface._remount=function(e){w95.shell.display.debugLayer&&(widgetInterface._domSkeleton.remove(),recurse_descendant_widgets(widgetInterface,(e=>e._domSkeleton.remove()))),widgetInterface.BeforeUnmount?.(),recurse_descendant_widgets(widgetInterface,(e=>e.BeforeUnmount?.()));const t=mount_widget({mount_fn,parentWidget,mountOptions,renderOptions});w95.debug?.assert("object"==typeof t);for(let e=0;;e++){const r=t.$descendants[e]?.widget,n=widgetInterface.$descendants[e]?.widget;if(!r||!n||r._type!==n._type)break;r._hideMesh!==n._hideMesh&&(r._hiddenStatusChanged=r._hideMesh),"window"===r._type&&r.title!==n.title&&(r._windowTitleChanged=!0)}if(e){const r=e.$childWidgets.indexOf(widgetInterface);w95.debug?.assert(r>=0),e.$childWidgets[r]=t}return t};for(const e of Object.keys(widgetInterface.Message||[]))widgetInterface.Message[e]=widgetInterface.Message[e].bind(widgetInterface);for(const e of Object.keys(widgetInterface.Event||[]))widgetInterface.Event[e]=widgetInterface.Event[e].bind(widgetInterface);w95.state.mount(widgetInterface,(()=>{widgetInterface._remountRequested=!0}),(()=>{widgetInterface._rerenderRequested=!0}));for(const e of widgetInterface._mesh)for(const t of e.vertices)t.x=~~t.x,t.y=~~t.y;{const e=t.filter((e=>"function"==typeof e)),r=e.map((e=>e(widgetInterface)));Object.defineProperty(widgetInterface,"$childWidgets",{value:r})}{const e=[],t={};recurse_descendant_widgets(widgetInterface,((t,r,n)=>{e.push({widget:t,at:n}),t._hideMesh=t._hideMesh||widgetInterface._hideMesh}));for(const e of widgetInterface.$childWidgets){const r=e.$name;r&&!t.hasOwnProperty(r)&&(t[r]=e)}Object.defineProperty(widgetInterface,"$descendants",{value:e})}if(w95.shell.display.debugLayer){const e=widgetInterface._domSkeleton=document.createElement(`${widgetInterface._type.replace("_","-")}-w95`);e.style.width=widgetInterface.width*w95.shell.display.scale+"px",e.style.height=widgetInterface.height*w95.shell.display.scale+"px",e.style.left=widgetInterface.x*w95.shell.display.scale+"px",e.style.top=widgetInterface.y*w95.shell.display.scale+"px",e.classList.add("rerendered"),widgetInterface._hideMesh&&e.classList.add("hidden"),widgetInterface.hasFocus&&e.classList.add("focused"),widgetInterface.$name&&(e.dataset.name=widgetInterface.$name),["label","button"].includes(widgetInterface._type)&&(e.innerText=widgetInterface.text),clearInterval(e.$rerenderInterval),e.$rerenderInterval=setTimeout((()=>{e.classList.remove("rerendered")}),500),widgetInterface.$childWidgets.length&&widgetInterface.$childWidgets.every((e=>e._hideMesh))&&widgetInterface._domSkeleton.classList.add("hidden"),widgetInterface._domSkeleton.classList.contains("hidden")&&recurse_descendant_widgets(widgetInterface,(e=>{e._domSkeleton.classList.add("hidden")}))}}if(widgetInterface.Mounted?.({parentWidget}),expandedArgs.reserveState){const e=w95.state.head()-stateStartIdx,t=expandedArgs.reserveState-e;w95.debug?.assert(t>=0),w95.state.move_head(w95.state.head()+t)}return widgetInterface}function transformed_recursive_mesh(e,t=0,r=0){return w95.debug?.assert("number"==typeof t),w95.debug?.assert("number"==typeof r),w95.debug?.assert("object"==typeof e),function e(n,o={left:(n.x||0)+t,top:(n.y||0)+r,right:(n.x||0)+t+(n.width||0),bottom:(n.y||0)+r+(n.height||0)},i=[],a=t,s=r){w95.debug?.assert("w95-widget"===n?._what),w95.debug?.assert("object"==typeof o),w95.debug?.assert("number"==typeof a),w95.debug?.assert("number"==typeof s),w95.debug?.assert(Array.isArray(i));const d=n.x||0,l=n.y||0,c=n.width||0,u=n.height||0;n.isActiveDialog&&(o={left:0,top:0,right:w95.shell.display.width,bottom:w95.shell.display.height}),n._clipRect=o,a+=d,s+=l;const f=function(e,t,r,n){w95.debug?.assert(Array.isArray(e)),w95.debug?.assert("number"==typeof r),w95.debug?.assert("number"==typeof n);let o=e.map((e=>({...e,vertices:e.vertices.map((e=>({...e})))})));for(const e of o)for(const t of e.vertices)t.x+=r,t.y+=n;if(t){o=o.filter((e=>{let r=1/0,n=1/0,o=-1/0,i=-1/0;for(const t of e.vertices)t.x<r&&(r=t.x),t.x>o&&(o=t.x),t.y<n&&(n=t.y),t.y>i&&(i=t.y);const a=o-r,s=i-n,d=t.right-t.left,l=t.bottom-t.top;return 2*Math.abs(r+a/2-(t.left+d/2))<=a+d&&2*Math.abs(n+s/2-(t.top+l/2))<=s+l}));for(const e of o)e._clipRect=t}return o}(n._mesh,o,a,s);if(n.dom){const e=Math.min(n.width,n._clipRect.right-n._clipRect.left),t=Math.min(n.height,n._clipRect.bottom-n._clipRect.top);n.dom.style.left=Math.floor(a)*w95.shell.display.scale+"px",n.dom.style.top=Math.floor(s)*w95.shell.display.scale+"px",n.dom.style.width=Math.floor(e)*w95.shell.display.scale+"px",n.dom.style.height=Math.floor(t)*w95.shell.display.scale+"px",n.dom.style.fontSize=`${Math.max(50,100*(w95.shell.display.scale-1))}%`,n.dom.style.visibility="visible"}n._domSkeleton&&(n._domSkeleton.style.left=Math.floor(a)*w95.shell.display.scale+"px",n._domSkeleton.style.top=Math.floor(s)*w95.shell.display.scale+"px");const h=i.length;if(!n._hideMesh){i.unshift(...f);const t=!o||n.isActivePopupMenu;for(const r of n.$childWidgets){e(r,t?null:{left:Math.max(o.left,a),top:Math.max(o.top,s),right:Math.min(o.right,a+c),bottom:Math.min(o.bottom,s+u)},i,a,s)}}if(n.isActivePopupMenu||n.isActiveDialog)for(let e=0;e<i.length-h;e++)for(const t of i[e].vertices)t.z--;return i}(e)}function recurse_descendant_widgets(e,t=(e,t,r)=>{},r=!1,n={x:0,y:0}){if(e){w95.debug?.assert("object"==typeof e);for(const o of e.$childWidgets||[]){switch(r&&o._hideMesh||t(o,e,{x:n.x+o.x,y:n.y+o.y})){case!0:continue;case null:return}recurse_descendant_widgets(o,t,r,{x:n.x+o.x,y:n.y+o.y})}}}function widget_contains_child(e,t){w95.debug?.assert("w95-widget"===e._what),w95.debug?.assert("w95-widget"===t._what);let r=!1;return recurse_descendant_widgets(e,(e=>{if(e===t)return r=!0,null})),r}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})();var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{w95:()=>L}),__webpack_require__(675),__webpack_require__.p;var e=__webpack_require__(439);const t={named:{transparent:Rngon.color(0,0,0,0),offwhite:Rngon.color(230,230,230),...Object.keys(Rngon.color).reduce(((e,t)=>({...e,[t]:Rngon.color[t]})),{})},window:{background:Rngon.color(192,192,192),foreground:Rngon.color(0,0,0),titleBar:{background:Rngon.color(0,0,128),inactiveBackground:Rngon.color(128,128,128),foreground:Rngon.color(255,255,255),inactiveForeground:Rngon.color(192,192,192)}},widget:{background:Rngon.color(192,192,192),foreground:Rngon.color(0,0,0),disabled1:Rngon.color(128,128,128),disabled2:Rngon.color(255,255,255)},frame:{background:Rngon.color(255,255,255),light:Rngon.color(255,255,255),dark:Rngon.color(0,0,0),lighter:Rngon.color(223,223,223),darker:Rngon.color(128,128,128)}};var r=__webpack_require__(960);setInterval((function(){n=new Date,Array.from(o).forEach((e=>e(n)))}),1e3);let n=new Date;const o=[],i={get now(){return n},listen:function(e=()=>{}){o.push(e)},unlisten:function(e){const t=o.lastIndexOf(e);t>=0&&o.splice(t,1)}},a={activeStore:void 0,idx:0};function s(e,t){if(w95.debug?.assert(t===w95.noEffect||t===w95.reRenderOnly||["function","undefined"].includes(typeof t)),s.suppress){const r=new d(e,t);return r.remount_parent_widget=s.app.rerender,r.rerender_parent_widget=s.app.remount,r}{const r=a.idx++;return a.activeStore[r]||(a.activeStore[r]=new d(e,t)),a.activeStore[r]}}function d(e,t){this.now=e,this.effect=t,this.set=function(e){if(e!==this.now){const r=this.now;switch(this.now=e,t){case w95.noEffect:return;case w95.reRenderOnly:return this.rerender_parent_widget();default:return!1===this.effect?.({now:this.now,previous:r,app:this.app,widget:this.widget})?this.now=r:this.remount_parent_widget()}}}.bind(this),this.remount_parent_widget=function(){console.warn("No parent widget mount function assigned.")},this.rerender_parent_widget=function(){console.warn("No parent widget render function assigned.")}}s.suppress=!1,s.use=function(e,t){w95.debug?.assert(Array.isArray(e)),a.activeStore=e,a.idx=0,s.app=t},s.move_head=function(e){a.idx=e},s.head=function(){return a.idx},s.mount=function(e,t,r){w95.debug?.assert("object"==typeof e),w95.debug?.assert("function"==typeof t);for(let n=e._stateStartIdx;n<a.idx;n++)a.activeStore[n].remount_parent_widget=t,a.activeStore[n].rerender_parent_widget=r,a.activeStore[n].widget=e,a.activeStore[n].app=s.app};const l=[],c={listen:function(e=()=>{}){l.push(e)},unlisten:function(e){const t=l.lastIndexOf(e);t>=0?l.splice(t,1):console.debug("tick::unlisten: No such callback function.")}},u={rasterizer:function(e){const t=Rngon.default.render.pipeline.rasterizer;for(const r of e.screenSpaceNgons)switch(r.vertices.length){case 0:continue;case 1:t.point(e,r.vertices[0],r.material);break;case 2:p(e,r);break;default:h(e,r)}},transformClipLighter:function({renderContext:e,mesh:t}){e.screenSpaceNgons=t.ngons.filter((e=>e.vertices.length));for(const t of e.screenSpaceNgons){for(const e of t.vertices)e.x=Math.floor(e.x),e.y=Math.floor(e.y);t._clipRect||(t._clipRect={top:0,left:0,right:e.resolution.width,bottom:e.resolution.height}),t._clipRect.top=~~Math.max(t._clipRect.top,0),t._clipRect.bottom=~~Math.min(t._clipRect.bottom,e.resolution.height),t._clipRect.left=~~Math.max(t._clipRect.left,0),t._clipRect.right=~~Math.min(t._clipRect.right,e.resolution.width)}},surfaceWiper:function(e){const t=e.depthBuffer,r=e.pixelBuffer32,n=w95.windowManager.apps.find((t=>t.id===e.contextName));if(n._dirtyRegion)for(const e of n._dirtyRegion){let n=e.x+e.y*t.width;const o=t.width-e.width;if(e.isStatic)for(let r=0;r<e.height;r++){for(let r=0;r<e.width;r++)t.data[n++]=1/0;n+=o}else for(let i=0;i<e.height;i++){for(let o=0;o<e.width;o++)r[n]=0,t.data[n]=1/0,n++;n+=o}}else Rngon.default.render.pipeline.surfaceWiper(e)}},f={useFullInterpolation:!1,farPlane:1};function h(e,t){const r=e.depthBuffer.data,n=e.pixelBuffer32,o=e.resolution.width,i=t.material,a=i.texture||null,s=t._clipRect,d=Math.max(s.top,t.vertices[0].y),l=Math.min(s.bottom,t.vertices[2].y),c=d-t.vertices[0].y;if(a){const e=Math.max(s.left,t.vertices[0].x),u=Math.min(s.right,t.vertices[1].x),f=e-t.vertices[0].x,h=t.vertices[0].z,p=a.pixels;for(let t=d;t<l;t++){let s=t*o+e,l=4*~~((t-d+c)*a.width+f);for(let t=e;t<u;t++){if((!i.allowAlphaReject||p[l+3]>127)&&r[s]>h){let e,t,o;a.boolean?(e=i.color.red,t=i.color.green,o=i.color.blue):(e=p[l+0]*i.color.unitRange.red,t=p[l+1]*i.color.unitRange.green,o=p[l+2]*i.color.unitRange.blue),i.isDisabled&&(e=t=o=.5*e+.3*t+.2*o),i.isColorInverted&&(e=255-e,t=255-t,o=255-o),n[s]=(255<<24)+(o<<16)+(t<<8)+~~e,r[s]=h}s++,l+=4}}}else{const e=Math.max(s.left,t.vertices[0].x),a=Math.min(s.right,t.vertices[1].x),c=t.vertices[0].z,{red:u,green:f,blue:h,alpha:p}=i.color;for(let t=d;t<l;t++)for(let i=e;i<a;i++){const e=i+t*o;r[e]<=c||(n[e]=(p<<24)+(h<<16)+(f<<8)+~~u,r[e]=c)}}}function p(e,t){w95.debug?.assert(2===t.vertices.length);const r=t.material.color;if(r.alpha<255)return;const n=e.resolution,o=t.vertices[0],i=t.vertices[1];if(o.x<0&&i.x<0||o.y<0&&i.y<0||o.x>=n.width&&i.x>=n.width||o.y>=n.height&&i.y>=n.height)return;const a=e.useDepthBuffer?e.depthBuffer.data:null,s=new Uint32Array(e.pixelBuffer.data.buffer),d=e.pixelBuffer.width,l=t._clipRect,c=o.z,u=Math.max(l.left,o.x),f=Math.max(l.top,o.y),h=Math.min(l.right,i.x),p=Math.min(l.bottom,i.y),w=f===p,g=(255<<24)+(r.blue<<16)+(r.green<<8)+~~r.red;let m=w?u:f;const b=w?h:p;let y=u+f*d;const x=w?1:d;for(;m++<b;)a[y]>c&&(s[y]=g,a[y]=c),y+=x}const w=(0,e._$)((function({x:e=0,y:t=0,width:r=10,height:n=22,text:o="",icon:i=w95.icon.applicationIcon16x16,isPressed:a=!1,isHidden:s=!0}={}){w95.debug?.assert("number"==typeof e),w95.debug?.assert("number"==typeof t),w95.debug?.assert("number"==typeof r),w95.debug?.assert("number"==typeof n),w95.debug?.assert("string"==typeof o),w95.debug?.assert("boolean"==typeof a),w95.debug?.assert("boolean"==typeof s),w95.debug?.assert("object"==typeof i),e=w95.state(e),r=w95.state(r),s=w95.state(s),i=w95.state(i),o=w95.state(o),a=w95.state(a);const d=w95.state(void 0);return{get x(){return e.now},get y(){return t},get width(){return r.now},get height(){return n},Form:()=>w95.widget.frame({width:r.now,height:n,shape:w95.frameShape.none,children:[w95.widget.panel({x:2,y:2,width:r.now-4,height:n-4,color:a.now?w95.palette.named.offwhite:w95.palette.widget.background}),...l(),w95.widget.bitmap({x:4+~~a.now,y:3+~~a.now,image:i.now}),w95.widget.label({x:4+i.now.width+4+~~a.now,y:~~a.now,width:r.now-i.now.width-12,height:n,text:o.now,elide:!0,styleHints:[w95.styleHint.action,w95.styleHint.alignVCenter,a.now?w95.styleHint.bold:0]},{hideIf:!o.now.length})]},{hideIf:s.now}),Event:{mousedown:()=>(w95.debug?.assert("app"===d.now._type),w95.windowManager.raise_window(a.now?w95.windowManager.desktop:d.now.window),!0)},Message:{setX(t){w95.debug?.assert("number"==typeof t),e.set(t)},setWidth(e){w95.debug?.assert("number"==typeof e),r.set(e)},setHidden(e){w95.debug?.assert("boolean"==typeof e),s.set(e)},setText(e){w95.debug?.assert("string"==typeof e),o.set(e)},setIcon(e){w95.debug?.assert("object"==typeof e),i.set(e)},setIsPressed(e){w95.debug?.assert("boolean"==typeof e),a.set(e)},setParentApp(e){w95.debug?.assert("app"===e._type),d.set(e)}}};function l(){const e=(()=>{let e=w95.palette.frame.light,t=w95.palette.frame.lighter,r=w95.palette.frame.darker,n=w95.palette.frame.dark;return a.now&&([e,t,r,n]=[n,r,t,e]),{light:e,lighter:t,darker:r,dark:n}})();return[Rngon.ngon([Rngon.vertex(1,1),Rngon.vertex(r.now-2,1)],{color:e.lighter}),Rngon.ngon([Rngon.vertex(r.now-2,1),Rngon.vertex(r.now-2,n-1)],{color:e.darker}),Rngon.ngon([Rngon.vertex(1,n-2),Rngon.vertex(r.now-1,n-2)],{color:e.darker}),Rngon.ngon([Rngon.vertex(1,1),Rngon.vertex(1,n-1)],{color:e.lighter}),Rngon.ngon([Rngon.vertex(r.now-1,0),Rngon.vertex(r.now-1,n)],{color:e.dark}),Rngon.ngon([Rngon.vertex(0,n-1),Rngon.vertex(r.now,n-1)],{color:e.dark}),Rngon.ngon([Rngon.vertex(0,0),Rngon.vertex(r.now,0)],{color:e.light}),Rngon.ngon([Rngon.vertex(0,0),Rngon.vertex(0,n)],{color:e.light})]}})),g=(0,e._$)((function({parent:e,title:t="",text:r="",icon:n=w95.icon.error,buttons:o=[],onReject:i}={}){w95.debug?.assert("w95-widget"===e?._what),w95.debug?.assert("string"==typeof t),w95.debug?.assert("string"==typeof r),w95.debug?.assert(["function","undefined"].includes(typeof i)),w95.debug?.assert(Array.isArray(o));const a=w95.font.stringWidth(r),s=Math.max(2*w95.font.default.regular.lineHeight,w95.font.stringHeight(r)),d=Math.max(250,74+a),l=87+s,c=w95.state(0,w95.reRenderOnly),u=w95.state(0,w95.reRenderOnly),f=w95.state(!1);return{get x(){return c.now},get y(){return u.now},get width(){return d},get height(){return l},Closed(){f.set(!1)},Opened(){c.set(e?e.width/2-d/2:0),u.set(e?e.height/2-l:0),f.set(!0)},Form:()=>w95.widget.dialog({width:d,height:l,title:t,move(e,t){c.set(e+c.now),u.set(t+u.now)},children:[w95.widget.bitmap({x:10,y:10,image:n}),w95.widget.label({x:58,y:12,height:s,text:r,styleHints:[w95.styleHint.alignVCenter]}),w95.widget.horizontalLayout({y:29+s,padding:8,width:"pw",styleHints:[w95.styleHint.alignHCenter],children:o})],onClose:i},{hideIf:!f.now})}}));g.about=(0,e._$)((function({parent:e,text:t="",onClose:r}={}){return w95.debug?.assert("w95-widget"===e?._what),w95.debug?.assert("string"==typeof t),w95.debug?.assert("function"==typeof r),t=`${e.$app.Meta.name}${e.$app.Meta.version?` ${e.$app.Meta.version}`:""}${e.$app.Meta.author?` by ${e.$app.Meta.author}`:""}.${t.length?`\n\n${t}`:""}`,{get x(){return 0},get y(){return 0},get width(){return this.$("popup").width},get height(){return this.$("popup").height},Form:()=>g({$name:"popup",title:`About ${e.$app.Meta.name}`,parent:e,text:t,icon:w95.icon.information,buttons:[w95.widget.button({width:75,text:"OK",onClick:r})],onReject:r})}}));let m,b,y=!1,x=1,_=!1;const v=[],M={updatedApps:[],ngons:0,renderTime:0};let O;const z={},j={display:{get debugLayer(){return b},get geometry(){return M},get scale(){return x},set scale(e){w95.debug?.assert(Number.isInteger(e)),f.resolution=1/e,document.body.dataset.w95Scale=e,x=e,async function(e){Object.values(w95.cursor).forEach((t=>{const r=document.createElement("img");r.src=t.dataUrl,r.onload=()=>{const n=document.createElement("canvas");n.width=t.width*e,n.height=t.height*e;const o=n.getContext("2d");o.imageSmoothingEnabled=!1,o.drawImage(r,0,0,n.width,n.height),z[t.dataUrl]=n.toDataURL(),O===t&&S(O)}}))}(e),w95.shell.wallpaper=m,w95.shell.refresh()},get width(){return Math.floor((window.innerWidth-(1&window.innerWidth))/x)},get height(){return Math.floor((window.innerHeight-(1&window.innerHeight))/x)},get visibleHeight(){return w95.shell.display.height-(w95.registry["taskbar-height"]||0)+2},get refreshRate(){return v.reduce(((e,t)=>e+t),0)/(v.length||1)},get domElements(){return Array.from(document.body.querySelectorAll(".w95-dom-element"))},get screenShader(){},set screenShader(e){w95.debug?.assert("function"==typeof e),u.pixelShader=e}},get wallpaper(){return m},set wallpaper(e){w95.debug?.assert(y,"Must call `w95.shell.boot()` before assigning `w95.shell.wallpaper`."),w95.debug?.assert(["undefined","string"].includes(typeof e)),m=e;const t=document.getElementById("desktop");if(!t)return;if("string"!=typeof e||!e.length)return;const r=new Image;r.src=e,r.onload=function(){t.style.backgroundImage=`url("${m}")`,t.style.backgroundSize=`${r.width*w95.shell.display.scale}px ${r.height*w95.shell.display.scale}px`,t.width=0,w95.shell.refresh()}},set cursor(e=w95.cursor.arrow){e!==O&&(O=e,S(e))},get cursor(){return O},desktop:function({icons:e=[],showWatermark:t=!1}={}){return w95.debug?.assert(Array.isArray(e)),{Meta:{name:"Desktop",version:"0.1",author:"Tarpeeksi Hyvae Soft",description:"\n                This app renders a screen-wide borderless window to emulate the\n                Windows 95 desktop.\n            "},App(){const r=w95.state(w95.shell.display.width),n=w95.state(w95.shell.display.height);return{get x(){return 0},get y(){return 0},get width(){return r.now},get height(){return n.now},get isDesktop(){return!0},Message:{fitToDisplay(){r.set(w95.shell.display.width),n.set(w95.shell.display.height)}},Mounted(){const e=this.$("_window-contents").$childWidgets.filter((e=>"dynamicWrapper"===e._type&&!e.$childWidgets[0]._hideMesh));{const t=5,r=77,n=75;let o=5,i=t;for(const a of e)i+a.$childWidgets[0].height>w95.shell.display.visibleHeight&&(o+=n,i=t),a.Message.move(o,i),i+=r}},Form(){return w95.widget.window({parent:this,backgroundColor:w95.palette.named.transparent,styleHints:[w95.styleHint.desktop],children:[...e.map((e=>w95.widget.dynamicWrapper({widget:e}))),w95.widget.verticalLayout({width:r.now-20,height:"ph - 10 - (w95.registry['taskbar-height'] || 0)",styleHints:[w95.styleHint.alignBottom,w95.styleHint.alignRight],children:[w95.widget.label({color:w95.palette.named.white,text:`\bw95\b v.${w95.version}`})]},{hideIf:!t})],onMouseDown({widget:e}){w95.$recurseDescendantWidgets(e,(e=>{e.Message?.blur?.()}))}})}}}}},taskbar:function(){return{Meta:{name:"Taskbar",version:"0.1",author:"Tarpeeksi Hyvae Soft",description:"\n                This app renders a screen-wide borderless window to emulate the\n                Windows 95 desktop.\n            "},App(){w95.registry["taskbar-height"]=30;const e=w95.state(w95.shell.display.width+4),t=w95.state(w95.registry["taskbar-height"],(()=>w95.registry["taskbar-height"]=t.now)),r=w95.state(-2),n=w95.state(w95.shell.display.height-t.now+2),o=w95.state([]),i=w95.state(new Array(25).fill().map((e=>w()))),a=w95.state(0),s=e.now-72;return{get x(){return r.now},get y(){return n.now},get width(){return e.now},get height(){return t.now},get isTaskbar(){return!0},get buttons(){return this.$("_taskbar_buttons").$childWidgets},Mounted(){{const e=Math.min(163,Math.max(25,~~(s/o.now.length)));this.buttons.forEach((e=>e.Message.setHidden(!0))),o.now.forEach(((t,r)=>{const n=this.buttons[r],o=w95.windowManager.get_active_dialog(t).widget;n.Message.setParentApp(t),n.Message.setIsPressed(Boolean(t===w95.windowManager.apps[0]&&(!t.window.isBlurred||o&&!o.isBlurred))),n.Message.setHidden(!1),n.Message.setX(e*r),n.Message.setWidth(e-3),n.Message.setText(t.window.title),n.Message.setIcon(t.window.icon)}))}},Message:{fitToDisplay(){e.set(w95.shell.display.width+4),n.set(w95.shell.display.height-t.now+2)},addApp(e){w95.debug?.assert("app"===e?._type),o.now.length<i.now.length&&o.set([...o.now,e])},removeApp(e){w95.debug?.assert("app"===e?._type),o.set(o.now.filter((t=>t!==e)))},refresh(){a.set(a.now+1)}},Form(){return w95.widget.window({parent:this,styleHints:[w95.styleHint.plain],children:[w95.widget.frame({x:"pw - 59",y:4,width:58,height:22,children:[w95.widget.time({width:"pw",height:"ph",styleHints:[w95.styleHint.alignHCenter,w95.styleHint.alignVCenter]})]}),w95.widget.frame({$name:"_taskbar_buttons",x:1,y:4,width:s,shape:w95.frameShape.none,height:"ph - 8",children:i.now})]})}}}}},popup:g,refresh(){window.dispatchEvent(new Event("resize"))},boot({scale:e}={}){w95.debug?.assert(!y),y=!0,void 0!==e&&(k=()=>e),x=w95.shell.display.scale=k(),w95.shell.cursor=w95.cursor.arrow,document.getElementById("w95-debug-layer")?.remove(),b=null,["keydown","keyup","keypress","wheel"].forEach((e=>{window.addEventListener(e,w95.windowManager.user_input)})),window.addEventListener("load",(()=>{const e=w95.windowManager.desktop?.$app._canvas;if(e){const t=window.getComputedStyle(e);t.backgroundImage.startsWith("url(")&&(m=t.backgroundImage.match(/^url\("(.*?)"\)/)[1])}})),window.addEventListener("resize",(()=>{const e=k();w95.shell.display.scale!==e&&(w95.shell.display.scale=e),_=!0,W(),w95.windowManager.apps.forEach((e=>w95.$recurseDescendantWidgets(e,(e=>e.Message?.fitToDisplay?.()))))})),document.addEventListener("visibilitychange",(function(){document.hidden||w95.shell.refresh()})),window.addEventListener("focus",(function(){w95.shell.refresh()})),window.requestAnimationFrame(B)},run(e,{singleInstance:t=!1}={}){w95.windowManager.govern(e,{singleInstance:t}),W()}};function B(e,t,r=0){const n=!r||_;M.renderTime=0,M.updatedApps=n?w95.windowManager.apps.filter((e=>(delete e._dirtyRegion,e.update(!0),!0))):w95.windowManager.apps.filter((e=>e.update().length)),M.updatedApps.length&&(M.ngons=0,function(){for(const e of M.updatedApps){if(e._dirtyRegion){const t=e._dirtyRegion[0];t.isStatic=e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}const t=Rngon.mesh(e.mesh());M.ngons+=t.ngons.length,f.context=e.id,Rngon.render({target:e._canvas,meshes:[t],options:f,pipeline:u}),I(e)}}(),function(){for(let e=0;e<w95.windowManager.apps.length;e++){const t=w95.windowManager.apps[e],r=t.window.$descendants.filter((e=>"domElement"===e.widget._type&&!e.widget._hideMesh));if(!r.length)continue;const n=t.window.isBlurred||t.window.isGrabbed||t.window.isBorderGrabbed||Boolean(w95.windowManager.get_active_popup_menu(t).popupWidget)||Boolean(w95.windowManager.get_active_dialog(t).widget);r.forEach((e=>e.widget.Message.setIsSuppressed(n)))}}(),w95.shell.display.debugLayer&&function(){for(const e of M.updatedApps){w95.$recurseDescendantWidgets(e.rootWidget,((e,t)=>{t._domSkeleton.append(e._domSkeleton)}));for(const t of[e.rootWidget,e.appObject]){const r=t._domSkeleton;r.style.width=e.width*w95.shell.display.scale+"px",r.style.height=e.height*w95.shell.display.scale+"px",r.style.left=e.x*w95.shell.display.scale+"px",r.style.top=e.y*w95.shell.display.scale+"px"}}}()),_=!1,function(e){Array.from(l).forEach((t=>t(e)))}(t),w95.windowManager.post_tick_inspect(),function(e){v.push(1e3/(e||1e3)),v.length>20&&v.shift()}(t),M.renderTimeMs=performance.now()-e,window.requestAnimationFrame((t=>B(t,t-e,r+1)))}function k(){return window.innerHeight<=890?1:window.innerHeight<=1440?2:4}function S(e){const t=z[e.dataUrl];t&&(document.body.style.cursor=`url(\n        ${t})\n        ${e.xOffset*w95.shell.display.scale}\n        ${e.yOffset*w95.shell.display.scale},\n        auto\n    `)}function W(){for(const e of document.body.querySelectorAll("canvas.w95"))e.style.width=w95.shell.display.width*w95.shell.display.scale+"px",e.style.height=w95.shell.display.height*w95.shell.display.scale+"px"}function I(e){w95.debug?.assert("app"===e._type);const t=Boolean(w95.windowManager.get_active_dialog(e).widget),r=!w95.windowManager.isPopupMenuActive||w95.windowManager.get_active_popup_menu().popupWidget.$app;var n;t||r&&r===e?delete e._dirtyRegion:e._dirtyRegion=[(n={x:e.x,y:e.y,width:e.width,height:e.height},n.x=~~Math.max(0,Math.min(w95.shell.display.width,n.x)),n.y=~~Math.max(0,Math.min(w95.shell.display.height,n.y)),n.width=~~Math.min(w95.shell.display.width-n.x,n.width),n.height=~~Math.min(w95.shell.display.height-n.y,n.height),n)]}const $=new Proxy({},{get:(e,t)=>(w95.debug?.assert("string"==typeof t),e[t]),set:(e,t,r)=>(w95.debug?.assert("string"==typeof t),e[t]!==r&&(e[t]=r,w95.shell.refresh()),!0)}),R=[];let A,E,C=0;const P={get apps(){return R},get isPopupMenuActive(){return Boolean(w95.windowManager.get_active_popup_menu().popupWidget)},get isDialogActive(){return R.some((e=>w95.windowManager.get_active_dialog(e).widget))},get desktop(){return A?.window},get taskbar(){return E?.window},is_parent_window_blurred(e){w95.debug?.assert("w95-widget"===e._what);const t=w95.windowManager.get_active_dialog(e.$app).widget;return t?t.isBlurred:e.$app.window.isBlurred},get_active_popup_menu(){let e,t;for(const r of R)w95.$recurseDescendantWidgets(r.window,((n,o,i)=>{if(n.isActivePopupMenu)return e=n,t={x:i.x+r.x,y:i.y+r.y},null}));return{popupWidget:e,at:t}},get_active_dialog(e){if(!e)return null;let t,r;return w95.debug?.assert("app"===e._type),w95.$recurseDescendantWidgets(e.window,((n,o,i)=>{if(n.isActiveDialog)return t=n,r={x:i.x+e.x,y:i.y+e.y},null})),{widget:t,at:r}},raise_window(e,t=!1){if(w95.debug?.assert("w95-widget"===e._what),w95.debug?.assert("window"===e._type),!e.isBlurred)return;const r=R.findIndex((t=>t.window===e));if(r<0)return void console.warn("No such window to raise.");let n=r;!e.isDesktop&&r&&(R.unshift(R.splice(r,1)[0]),n=0),R.forEach(((e,r)=>{e.window?.Message?.[t||r!=n?"blur":"focus"]?.(),e._canvas.style.zIndex=-2*r}));const o=w95.windowManager.get_active_dialog(e.$app).widget;o&&(w95.debug?.assert("dialog"===o?._type),o.Message.focus()),E?.appObject.Message.refresh()},release_window(e){if(w95.debug?.assert("w95-widget"===e._what),w95.debug?.assert("window"===e._type),e.$app.appObject.$descendants.some((e=>!1===e.widget.BeforeAppExit?.())))return!1;const t=R.findIndex((t=>t.window===e));if(t<0)return void console.warn("No such running application to release.");const r=R[t];E?.appObject.Message.removeApp(r),w95.$recurseDescendantWidgets(r,(e=>!e._hideMesh&&e.Closed?.())),r.release(),r._canvas.remove(),r.rootWidget._domSkeleton?.remove(),R.splice(t,1),R.length>!!E+!!A?w95.windowManager.raise_window(R.filter((e=>![E,A].includes(e)))[0].window):A&&w95.windowManager.raise_window(A.window)},post_tick_inspect(){for(const e of R)e.window.isBlurred||w95.$recurseDescendantWidgets(e,(t=>{if(t.isActiveDialog)return e.window.Message.blur(),t.Message.focus(),w95.windowManager.update_autofocus(t),null})),e.window._windowTitleChanged&&(E?.appObject.Message.refresh(),e.window._windowTitleChanged=!1);w95.$recurseDescendantWidgets(R[0],(e=>{!0===e._hiddenStatusChanged?("dialog"===e._type&&w95.windowManager.raise_window(R[0].window),e.Closed?.()):!1===e._hiddenStatusChanged&&e.Opened?.(),e._hiddenStatusChanged=void 0}))},update_autofocus(e){w95.$recurseDescendantWidgets(e,(e=>{if(e._autofocus&&!e._hideMesh)return e.Message.focus(),e._autofocus=!1,null}))},govern(t,{singleInstance:r=!1}={}){[t].flat().forEach((t=>{const n=function(t,r,n=()=>({})){w95.debug?.assert("function"==typeof n);const o={get Meta(){return t},get id(){return r},get _type(){return"app"},get _what(){return"w95-widget"},get x(){return o.appObject.x},get y(){return o.appObject.y},get width(){return o.appObject.width},get height(){return o.appObject.height},get rootWidget(){return o.$childWidgets?.[0]},get appObject(){return o.rootWidget.$childWidgets[0]},get window(){return o.appObject.$childWidgets[0]},rerender(){o.rootWidget&&(o.rootWidget._remountRequested=!0)},rerasterize(){o.rootWidget&&(o.rootWidget._rerenderRequested=!0)},mesh:()=>(0,e.Hq)(o.window,o.appObject.x,o.appObject.y),update(t=!1){if(w95.state.use(o.state,o),t){const e=o.$childWidgets[0].$childWidgets[0];return w95.state.move_head(e._stateStartIdx),e._remount(o.$childWidgets[0]),o.$childWidgets[0]}const r=[];return(0,e.ud)(o,((e,t)=>{if(e._remountRequested||"nullState"===e._type)return w95.state.move_head(e._stateStartIdx),e._remount(t),r.push(e),!0;e._rerenderRequested&&(r.push(e),e._rerenderRequested=!1)}),!0),r},release(){o.rootWidget.BeforeUnmount?.(),(0,e.ud)(o.rootWidget,(e=>{e.BeforeUnmount?.(),e.dom?.remove()}))}};n._name=t.name.replace(/ /g,"-"),n._app=o,o.state=n.state=[];const i=[(0,e.Hg)({mount_fn:n,parentWidget:o})];return Object.defineProperty(o,"$childWidgets",{value:i}),w95.debug?.assert(Array.isArray(o.$childWidgets)),w95.debug?.assert(1===o.$childWidgets.length),w95.debug?.assert("w95-widget"===o.$childWidgets[0]._what),w95.debug?.assert("object"==typeof o.window),w95.debug?.assert("w95-widget"===o.window._what),w95.debug?.assert("window"===o.window._type),o}(t.Meta,C++,(()=>({...t,App:r=>()=>(0,e.Hg)({mount_fn:t.App,mountOptions:r})})));if(r&&R.some((e=>e.Meta.name===n.Meta.name)))return void w95.windowManager.raise_window(R.find((e=>e.Meta.name===n.Meta.name)).window);n.window.isDesktop?R.push(n):R.unshift(n);const o=n._canvas=document.createElement("canvas");o.classList.add("w95"),o.oncontextmenu=()=>!1,o.dataset.w95App=n.Meta.name,o.dataset.w95AppId=n.id,document.body.append(o),["mousemove","mousedown","mouseup","dblclick"].forEach((e=>{o.addEventListener(e,w95.windowManager.user_input)})),w95.shell.display.debugLayer?.append(n.rootWidget._domSkeleton),E=n.appObject.isTaskbar?n:E,A=n.appObject.isDesktop?n:A,n.appObject.Opened?.call(n),n.appObject.isTaskbar||n.appObject.isDesktop||E?.appObject.Message.addApp(n),n.appObject.isDesktop&&(o.id="desktop",w95.shell.wallpaper=w95.shell.wallpaper),w95.$recurseDescendantWidgets(n.window,(e=>!e._hideMesh&&e.Opened?.()))})),R.length&&w95.windowManager.raise_window(R[0].window),w95.windowManager.update_autofocus(R[0].window)},get_parent_app(t){if(t){w95.debug?.assert("w95-widget"===t._what);for(const r of R)if(r.window===t||(0,e.Aw)(r.window,t))return r}},move_window_to(e,{x:t,y:r}){w95.windowManager.move_window(e,{x:void 0!==t?t-e.$app.x:void 0,y:void 0!==r?r-e.$app.y:void 0})},move_window(e,{x:t,y:r}){w95.debug?.assert("window"===e._type),w95.debug?.assert(["undefined","number"].includes(typeof t)),w95.debug?.assert(["undefined","number"].includes(typeof r)),t&&(e.$app.x+=t),r&&(e.$app.y+=r),e.$app.rerasterize()},resize_window(e,{x:t,y:r,width:n,height:o}){w95.debug?.assert("window"===e._type),w95.debug?.assert(["undefined","number"].includes(typeof t)),w95.debug?.assert(["undefined","number"].includes(typeof r)),w95.debug?.assert(["undefined","number"].includes(typeof n)),w95.debug?.assert(["undefined","number"].includes(typeof o)),n&&(e.$app.width=n),o&&(e.$app.height=o),w95.windowManager.move_window_to(e.$app.window,{x:t,y:r})},root_widget(t){if(w95.debug?.assert("w95-widget"===t._what),"window"===t._type)return t;for(const r of R)if((0,e.Aw)(r.window,t))return r.window},user_input(t){const r={x:t.offsetX/w95.shell.display.scale,y:t.offsetY/w95.shell.display.scale},n=function(){let t;for(const r of R){if(r.window.hasFocus){t=r.window;break}(0,e.ud)(r.window,(e=>{if(e.hasFocus)return t=e,null}),!0)}return t}(),o=function(){let t;return R.forEach((n=>(0,e.ud)(n.window,((e,o,i)=>{if(e.isGrabbed||e.isBorderGrabbed)return t=e,t._intersectedAt={x:~~(r.x-n.x-i.x),y:~~(r.y-n.y-i.y)},null}),!0))),t}(),i=function(){if(w95.windowManager.isPopupMenuActive&&!w95.windowManager.get_active_dialog(R[0]))return R[0]?.window;for(const e of R){const{widget:t,at:n}=w95.windowManager.get_active_dialog(e),o={x:e.x,y:e.y,width:e.width,height:e.height};if(t&&(d(r,o)||d(r,{...t,...n})))return t._intersectedAt=n,t;if(d(r,o))return e.window}}();let a;switch("dialog"===i?._type?(w95.debug?.assert("object"==typeof i._intersectedAt),w95.debug?.assert("number"==typeof i._intersectedAt.x),w95.debug?.assert("number"==typeof i._intersectedAt.y),a=s(i,i._intersectedAt.x,i._intersectedAt.y)):a=s(i,i?.$app?.x||0,i?.$app?.y||0),t.constructor){case KeyboardEvent:{const e=w95.windowManager.apps[0].window;(n||i||e?.isBlurred||e.$app.appObject)?.Event?.[t.type]?.(t);break}case MouseEvent:case WheelEvent:if(R.forEach((r=>(0,e.ud)(r.window,(e=>{!e.isHovered&&a.includes(e)?e.Event?.mouseenter?.({event:t,at:e._intersectedAt}):e.isHovered&&!a.includes(e)&&e.Event?.mouseleave?.({event:t,at:e._intersectedAt})}),!0))),o)o.Event?.[t.type]?.({event:t,at:o._intersectedAt});else{if("mousedown"===t.type)if(a.some((e=>"menuAction"===e._type))||R[0]?.window.menuBar?.Message.closeMenus(),(0,e.ud)(R[0]?.window,(e=>{"dropdownBoxList"!==e._type||a.some((t=>t===e))||e.Message.close()})),n?.Message.blur(),"window"===i?._type)w95.windowManager.raise_window(i);else if("dialog"===i?._type){const e=w95.windowManager.root_widget(i);w95.debug?.assert("window"===e?._type),w95.windowManager.raise_window(e,!0)}let r=w95.cursor.arrow;if(!i?.isBlurred){const e=Math.min(...a.filter((e=>!e._hideMesh)).map((e=>e._zIndex))),n=a.reverse().find((t=>t.cursor&&!t._disabled&&t._zIndex<=e));n&&(r=n.cursor);let o=a.filter((e=>"function"==typeof e.Event?.[t.type])).map((e=>({widget:e,handler:e.Event?.[t.type],_intersectedAt:e._intersectedAt})));o.sort(((e,t)=>e.widget._zIndex<t.widget._zIndex?-1:1));for(const e of o)if(e.widget.Message?.focus?.(),!0===e.handler({event:t,at:e._intersectedAt}))break}w95.shell.cursor=w95.windowManager.isPopupMenuActive?w95.cursor.arrow:r}}function s(e,t=0,n=0,o=[]){if(void 0===e||"nullState"===e._type)return[];if(w95.debug?.assert(Array.isArray(o)),w95.debug?.assert("object"==typeof e),w95.debug?.assert("number"==typeof t),w95.debug?.assert("number"==typeof n),!e._hideMesh){d(r,{...e,x:t+e.x,y:n+e.y})&&(!e._clipRect||e.isActivePopupMenu||(i=r,a=e._clipRect,i.x>=a.left&&i.x<a.right&&i.y>=a.top&&i.y<a.bottom))&&(e._intersectedAt={x:~~(r.x-t-e.x),y:~~(r.y-n-e.y)},o.push(e)),t+=e.x,n+=e.y;const l=[...e.$childWidgets].sort(((e,t)=>e._zIndex<t._zIndex?-1:1));for(const e of l)s(e,t,n,o)}var i,a;return o}function d(e,t){return!(!e||!t)&&e.x>=t.x&&e.x<t.x+t.width&&e.y>=t.y&&e.y<t.y+t.height}}},L={color:Rngon.color,clock:i,tick:c,registry:$,palette:t,state:s,debug:r.Y,shell:j,windowManager:P,StateVariable:d,version:"2024-12-19",$recurseDescendantWidgets:e.ud,font:{stringWidth(e="",t=L.font.default,r=t.regular,n=!0,o=1,i=3){L.debug?.assert("string"==typeof e),L.debug?.assert("object"==typeof t),L.debug?.assert("number"==typeof o),L.debug?.assert("number"==typeof i);let a=r;return e.split("\n").reduce(((e,r)=>Math.max(e,function(e){let r=-o*Boolean(e.length);for(let i=0;i<e.length;i++){const s=e[i].charCodeAt(0),d=a[s]||a[63];if(n)switch(s){case 8:a=a===t.regular?t.bold:t.regular;continue;case 11:continue;case 13:i+=e.slice(i+2,e.indexOf("}",i+2)).length+2;continue}else if(13===s)continue;switch(s){case 9:r+=4*a.spaceWidth;break;case 32:r+=a.spaceWidth;break;default:{const e=i&&d.leftSpacing||0;a.monospace?r+=e+(a.spaceWidth+d.rightSpacing):r+=e+d.width+(d.rightSpacing||0)+o;break}}}return r}(r))),0)},stringHeight:(e="",t=L.font.default,r=t.regular)=>(L.debug?.assert("string"==typeof e),L.debug?.assert("object"==typeof t),e.split("\n").length*r.lineHeight)},widget:e._$,styleHint:{...["void","raised","lowered","disabled","action","focused","plain","dialog","noBorder","bold","underlined","alignVCenter","alignTop","alignBottom","alignHCenter","alignLeft","alignRight","vertical","horizontal","solid","dashed","dotted","inverted","resizable","transparent","first","fitContentsHorizontal","fitContentsVertical","shortcut","noDisable","hideVerticalScrollBar","showVerticalScrollBar","hideHorizontalScrollBar","showHorizontalScrollBar"].reduce(((e,t)=>({...e,[t]:t})),{})},frameShape:{dialog:"dialog",resizableWindow:"resizableWindow",widget:"widget",inlineWidget:"inlineWidget",input:"input",box:"box",fancyBox:"fancyBox",plain:"plain",none:"none",selector:"selector",dropdownList:"dropdownList",dropdownButton:"dropdownButton",tabControlButton:"tabControlButton"},buttonShape:{regular:"regular",dropdown:"dropdown",tabControl:"tabControl",flat:"flat"},noEffect:null,reRenderOnly:!0}})();var __webpack_export_target__=self;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();